define(["./when-7ef6387a","./Check-ed6a1804","./Math-85667bf9","./Ellipsoid-1cbb4ac9","./Transforms-c20c38d0","./RuntimeError-5b606d78","./Cartesian2-73569d25","./WebGLConstants-30fc6f5c","./ComponentDatatype-a863af81","./AttributeCompression-5e3c38a2","./IntersectionTests-faaebeeb","./Plane-6ff6c057","./WebMercatorProjection-07c8bb70","./createTaskProcessorWorker","./EllipsoidTangentPlane-13a4f7fd","./OrientedBoundingBox-565e6407","./TerrainEncoding-a0f3ccb2"],(function(e,t,i,a,n,r,o,s,u,h,c,d,l,g,m,p,f){"use strict";var v=Uint16Array.BYTES_PER_ELEMENT,I=Int32Array.BYTES_PER_ELEMENT,E=Uint32Array.BYTES_PER_ELEMENT,T=Float32Array.BYTES_PER_ELEMENT,C=Float64Array.BYTES_PER_ELEMENT;function M(t,a,n){n=e.defaultValue(n,i.CesiumMath);for(var r=t.length,o=0;o<r;++o)if(n.equalsEpsilon(t[o],a,i.CesiumMath.EPSILON12))return o;return-1}var N=new a.Cartographic,x=new a.Cartesian3,b=new a.Cartesian3,S=new a.Cartesian3,w=new n.Matrix4;function P(t,r,s,u,h,c,d,l,g,m){for(var p=d.length,f=0;f<p;++f){var v=d[f],I=v.cartographic,E=v.index,T=t.length,C=I.longitude,M=I.latitude;M=i.CesiumMath.clamp(M,-i.CesiumMath.PI_OVER_TWO,i.CesiumMath.PI_OVER_TWO);var b=I.height-c.skirtHeight;c.hMin=Math.min(c.hMin,b),a.Cartographic.fromRadians(C,M,b,N),g&&(N.longitude+=l),g?f===p-1?N.latitude+=m:0===f&&(N.latitude-=m):N.latitude+=l;var S=c.ellipsoid.cartographicToCartesian(N);t.push(S),r.push(b),s.push(o.Cartesian2.clone(s[E])),u.length>0&&u.push(u[E]),n.Matrix4.multiplyByPoint(c.toENU,S,x);var w=c.minimum,P=c.maximum;a.Cartesian3.minimumByComponent(x,w,w),a.Cartesian3.maximumByComponent(x,P,P);var B=c.lastBorderPoint;if(e.defined(B)){var y=B.index;h.push(y,T-1,T,T,E,y)}c.lastBorderPoint=v}}return g((function(t,s){t.ellipsoid=a.Ellipsoid.clone(t.ellipsoid),t.rectangle=o.Rectangle.clone(t.rectangle);var u=function(t,s,u,h,c,d,g,B,y,A){var R,_,W,F,O,Y;e.defined(h)?(R=h.west,_=h.south,W=h.east,F=h.north,O=h.width,Y=h.height):(R=i.CesiumMath.toRadians(c.west),_=i.CesiumMath.toRadians(c.south),W=i.CesiumMath.toRadians(c.east),F=i.CesiumMath.toRadians(c.north),O=i.CesiumMath.toRadians(h.width),Y=i.CesiumMath.toRadians(h.height));var k,U,V=[_,F],H=[R,W],L=n.Transforms.eastNorthUpToFixedFrame(s,u),D=n.Matrix4.inverseTransformation(L,w);B&&(k=l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(_),U=1/(l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(F)-k));var G=new DataView(t),j=Number.POSITIVE_INFINITY,z=Number.NEGATIVE_INFINITY,q=b;q.x=Number.POSITIVE_INFINITY,q.y=Number.POSITIVE_INFINITY,q.z=Number.POSITIVE_INFINITY;var J=S;J.x=Number.NEGATIVE_INFINITY,J.y=Number.NEGATIVE_INFINITY,J.z=Number.NEGATIVE_INFINITY;var K,Q,X=0,Z=0,$=0;for(Q=0;Q<4;++Q){var ee=X;K=G.getUint32(ee,!0),ee+=E;var te=i.CesiumMath.toRadians(180*G.getFloat64(ee,!0));ee+=C,-1===M(H,te)&&H.push(te);var ie=i.CesiumMath.toRadians(180*G.getFloat64(ee,!0));ee+=C,-1===M(V,ie)&&V.push(ie),ee+=2*C;var ae=G.getInt32(ee,!0);ee+=I,Z+=ae,ae=G.getInt32(ee,!0),$+=3*ae,X+=K+E}var ne=[],re=[],oe=new Array(Z),se=new Array(Z),ue=new Array(Z),he=B?new Array(Z):[],ce=new Array($),de=[],le=[],ge=[],me=[],pe=0,fe=0;for(X=0,Q=0;Q<4;++Q){K=G.getUint32(X,!0);var ve=X+=E,Ie=i.CesiumMath.toRadians(180*G.getFloat64(X,!0));X+=C;var Ee=i.CesiumMath.toRadians(180*G.getFloat64(X,!0));X+=C;var Te=i.CesiumMath.toRadians(180*G.getFloat64(X,!0)),Ce=.5*Te;X+=C;var Me=i.CesiumMath.toRadians(180*G.getFloat64(X,!0)),Ne=.5*Me;X+=C;var xe=G.getInt32(X,!0);X+=I;var be=G.getInt32(X,!0);X+=I,X+=I;for(var Se=new Array(xe),we=0;we<xe;++we){var Pe=Ie+G.getUint8(X++)*Te;N.longitude=Pe;var Be=Ee+G.getUint8(X++)*Me;N.latitude=Be;var ye=G.getFloat32(X,!0);if(X+=T,0!==ye&&ye<A&&(ye*=-Math.pow(2,y)),ye*=6371010*d,N.height=ye,-1!==M(H,Pe)||-1!==M(V,Be)){var Ae=M(ne,N,a.Cartographic);if(-1!==Ae){Se[we]=re[Ae];continue}ne.push(a.Cartographic.clone(N)),re.push(pe)}Se[we]=pe,Math.abs(Pe-R)<Ce?de.push({index:pe,cartographic:a.Cartographic.clone(N)}):Math.abs(Pe-W)<Ce?ge.push({index:pe,cartographic:a.Cartographic.clone(N)}):Math.abs(Be-_)<Ne?le.push({index:pe,cartographic:a.Cartographic.clone(N)}):Math.abs(Be-F)<Ne&&me.push({index:pe,cartographic:a.Cartographic.clone(N)}),j=Math.min(ye,j),z=Math.max(ye,z),ue[pe]=ye;var Re=u.cartographicToCartesian(N);oe[pe]=Re,B&&(he[pe]=(l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(Be)-k)*U),n.Matrix4.multiplyByPoint(D,Re,x),a.Cartesian3.minimumByComponent(x,q,q),a.Cartesian3.maximumByComponent(x,J,J);var _e=(Pe-R)/(W-R);_e=i.CesiumMath.clamp(_e,0,1);var We=(Be-_)/(F-_);We=i.CesiumMath.clamp(We,0,1),se[pe]=new o.Cartesian2(_e,We),++pe}for(var Fe=3*be,Oe=0;Oe<Fe;++Oe,++fe)ce[fe]=Se[G.getUint16(X,!0)],X+=v;if(K!==X-ve)throw new r.RuntimeError("Invalid terrain tile.")}oe.length=pe,se.length=pe,ue.length=pe,B&&(he.length=pe);var Ye=pe,ke=fe,Ue={hMin:j,lastBorderPoint:void 0,skirtHeight:g,toENU:D,ellipsoid:u,minimum:q,maximum:J};de.sort((function(e,t){return t.cartographic.latitude-e.cartographic.latitude})),le.sort((function(e,t){return e.cartographic.longitude-t.cartographic.longitude})),ge.sort((function(e,t){return e.cartographic.latitude-t.cartographic.latitude})),me.sort((function(e,t){return t.cartographic.longitude-e.cartographic.longitude}));if(P(oe,ue,se,he,ce,Ue,de,-1e-5*O,!0,-1e-5*Y),P(oe,ue,se,he,ce,Ue,le,-1e-5*Y,!1),P(oe,ue,se,he,ce,Ue,ge,1e-5*O,!0,1e-5*Y),P(oe,ue,se,he,ce,Ue,me,1e-5*Y,!1),de.length>0&&me.length>0){var Ve=de[0].index,He=Ye,Le=me[me.length-1].index,De=oe.length-1;ce.push(Le,De,He,He,Ve,Le)}Z=oe.length;var Ge,je=n.BoundingSphere.fromPoints(oe);e.defined(h)&&(Ge=p.OrientedBoundingBox.fromRectangle(h,j,z,u));for(var ze=new f.EllipsoidalOccluder(u).computeHorizonCullingPointPossiblyUnderEllipsoid(s,oe,j),qe=new m.AxisAlignedBoundingBox(q,J,s),Je=new f.TerrainEncoding(qe,Ue.hMin,z,L,!1,B),Ke=new Float32Array(Z*Je.getStride()),Qe=0,Xe=0;Xe<Z;++Xe)Qe=Je.encode(Ke,Qe,oe[Xe],se[Xe],ue[Xe],void 0,he[Xe]);var Ze=de.map((function(e){return e.index})).reverse(),$e=le.map((function(e){return e.index})).reverse(),et=ge.map((function(e){return e.index})).reverse(),tt=me.map((function(e){return e.index})).reverse();return $e.unshift(et[et.length-1]),$e.push(Ze[0]),tt.unshift(Ze[Ze.length-1]),tt.push(et[0]),{vertices:Ke,indices:new Uint16Array(ce),maximumHeight:z,minimumHeight:j,encoding:Je,boundingSphere3D:je,orientedBoundingBox:Ge,occludeePointInScaledSpace:ze,vertexCountWithoutSkirts:Ye,indexCountWithoutSkirts:ke,westIndicesSouthToNorth:Ze,southIndicesEastToWest:$e,eastIndicesNorthToSouth:et,northIndicesWestToEast:tt}}(t.buffer,t.relativeToCenter,t.ellipsoid,t.rectangle,t.nativeRectangle,t.exaggeration,t.skirtHeight,t.includeWebMercatorT,t.negativeAltitudeExponentBias,t.negativeElevationThreshold),h=u.vertices;s.push(h.buffer);var c=u.indices;return s.push(c.buffer),{vertices:h.buffer,indices:c.buffer,numberOfAttributes:u.encoding.getStride(),minimumHeight:u.minimumHeight,maximumHeight:u.maximumHeight,boundingSphere3D:u.boundingSphere3D,orientedBoundingBox:u.orientedBoundingBox,occludeePointInScaledSpace:u.occludeePointInScaledSpace,encoding:u.encoding,vertexCountWithoutSkirts:u.vertexCountWithoutSkirts,indexCountWithoutSkirts:u.indexCountWithoutSkirts,westIndicesSouthToNorth:u.westIndicesSouthToNorth,southIndicesEastToWest:u.southIndicesEastToWest,eastIndicesNorthToSouth:u.eastIndicesNorthToSouth,northIndicesWestToEast:u.northIndicesWestToEast}}))}));
//# sourceMappingURL=createVerticesFromGoogleEarthEnterpriseBuffer.js.map
