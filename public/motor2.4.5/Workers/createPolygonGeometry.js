define(["./when-7ef6387a","./Check-ed6a1804","./Math-85667bf9","./Ellipsoid-1cbb4ac9","./Transforms-c20c38d0","./RuntimeError-5b606d78","./Cartesian2-73569d25","./WebGLConstants-30fc6f5c","./ComponentDatatype-a863af81","./GeometryAttribute-6b3c7112","./GeometryAttributes-cb18da36","./AttributeCompression-5e3c38a2","./GeometryPipeline-585f444f","./EncodedCartesian3-fbe51c6d","./IndexDatatype-f12d39b5","./IntersectionTests-faaebeeb","./Plane-6ff6c057","./GeometryOffsetAttribute-5cfc2755","./VertexFormat-d75df48f","./GeometryInstance-ebd8a828","./arrayRemoveDuplicates-9458abce","./BoundingRectangle-41c90928","./EllipsoidTangentPlane-13a4f7fd","./ArcType-2ee8dfbb","./EllipsoidRhumbLine-01425f3c","./PolygonPipeline-5110db34","./PolygonGeometryLibrary-bbb55e41","./EllipsoidGeodesic-2bb1f4ee"],(function(e,t,r,o,a,i,n,s,l,u,p,c,y,d,g,m,h,f,b,v,_,P,C,T,w,I,A,x){"use strict";var E=new o.Cartographic,G=new o.Cartographic;function O(e,t,r,o){var a=o.cartesianToCartographic(e,E).height,i=o.cartesianToCartographic(t,G);i.height=a,o.cartographicToCartesian(i,t);var n=o.cartesianToCartographic(r,G);n.height=a-100,o.cartographicToCartesian(n,r)}var H=new P.BoundingRectangle,D=new o.Cartesian3,V=new o.Cartesian3,F=new o.Cartesian3,L=new o.Cartesian3,N=new o.Cartesian3,R=new o.Cartesian3,M=new o.Cartesian3,S=new o.Cartesian3,k=new o.Cartesian3,B=new n.Cartesian2,z=new n.Cartesian2,U=new o.Cartesian3,W=new a.Quaternion,Y=new a.Matrix3,j=new a.Matrix3;function Q(t){var i=t.vertexFormat,s=t.geometry,p=t.shadowVolume,c=s.attributes.position.values,y=c.length,d=t.wall,g=t.top||d,m=t.bottom||d;if(i.st||i.normal||i.tangent||i.bitangent||p){var h=t.boundingRectangle,b=t.tangentPlane,v=t.ellipsoid,_=t.stRotation,P=t.perPositionHeight,C=B;C.x=h.x,C.y=h.y;var T,w=i.st?new Float32Array(y/3*2):void 0;i.normal&&(T=P&&g&&!d?s.attributes.normal.values:new Float32Array(y));var I=i.tangent?new Float32Array(y):void 0,A=i.bitangent?new Float32Array(y):void 0,x=p?new Float32Array(y):void 0,E=0,G=0,H=V,Q=F,q=L,K=!0,Z=Y,J=j;if(0!==_){var X=a.Quaternion.fromAxisAngle(b._plane.normal,_,W);Z=a.Matrix3.fromQuaternion(X,Z),X=a.Quaternion.fromAxisAngle(b._plane.normal,-_,W),J=a.Matrix3.fromQuaternion(X,J)}else Z=a.Matrix3.clone(a.Matrix3.IDENTITY,Z),J=a.Matrix3.clone(a.Matrix3.IDENTITY,J);var $=0,ee=0;g&&m&&($=y/2,ee=y/3,y/=2);for(var te=0;te<y;te+=3){var re=o.Cartesian3.fromArray(c,te,U);if(i.st){var oe=a.Matrix3.multiplyByVector(Z,re,D);oe=v.scaleToGeodeticSurface(oe,oe);var ae=b.projectPointOntoPlane(oe,z);n.Cartesian2.subtract(ae,C,ae);var ie=r.CesiumMath.clamp(ae.x/h.width,0,1),ne=r.CesiumMath.clamp(ae.y/h.height,0,1);m&&(w[E+ee]=ie,w[E+1+ee]=ne),g&&(w[E]=ie,w[E+1]=ne),E+=2}if(i.normal||i.tangent||i.bitangent||p){var se=G+1,le=G+2;if(d){if(te+3<y){var ue=o.Cartesian3.fromArray(c,te+3,N);if(K){var pe=o.Cartesian3.fromArray(c,te+y,R);P&&O(re,ue,pe,v),o.Cartesian3.subtract(ue,re,ue),o.Cartesian3.subtract(pe,re,pe),H=o.Cartesian3.normalize(o.Cartesian3.cross(pe,ue,H),H),K=!1}o.Cartesian3.equalsEpsilon(ue,re,r.CesiumMath.EPSILON10)&&(K=!0)}(i.tangent||i.bitangent)&&(q=v.geodeticSurfaceNormal(re,q),i.tangent&&(Q=o.Cartesian3.normalize(o.Cartesian3.cross(q,H,Q),Q)))}else H=v.geodeticSurfaceNormal(re,H),(i.tangent||i.bitangent)&&(P&&(M=o.Cartesian3.fromArray(T,G,M),S=o.Cartesian3.cross(o.Cartesian3.UNIT_Z,M,S),S=o.Cartesian3.normalize(a.Matrix3.multiplyByVector(J,S,S),S),i.bitangent&&(k=o.Cartesian3.normalize(o.Cartesian3.cross(M,S,k),k))),Q=o.Cartesian3.cross(o.Cartesian3.UNIT_Z,H,Q),Q=o.Cartesian3.normalize(a.Matrix3.multiplyByVector(J,Q,Q),Q),i.bitangent&&(q=o.Cartesian3.normalize(o.Cartesian3.cross(H,Q,q),q)));i.normal&&(t.wall?(T[G+$]=H.x,T[se+$]=H.y,T[le+$]=H.z):m&&(T[G+$]=-H.x,T[se+$]=-H.y,T[le+$]=-H.z),(g&&!P||d)&&(T[G]=H.x,T[se]=H.y,T[le]=H.z)),p&&(d&&(H=v.geodeticSurfaceNormal(re,H)),x[G+$]=-H.x,x[se+$]=-H.y,x[le+$]=-H.z),i.tangent&&(t.wall?(I[G+$]=Q.x,I[se+$]=Q.y,I[le+$]=Q.z):m&&(I[G+$]=-Q.x,I[se+$]=-Q.y,I[le+$]=-Q.z),g&&(P?(I[G]=S.x,I[se]=S.y,I[le]=S.z):(I[G]=Q.x,I[se]=Q.y,I[le]=Q.z))),i.bitangent&&(m&&(A[G+$]=q.x,A[se+$]=q.y,A[le+$]=q.z),g&&(P?(A[G]=k.x,A[se]=k.y,A[le]=k.z):(A[G]=q.x,A[se]=q.y,A[le]=q.z))),G+=3}}i.st&&(s.attributes.st=new u.GeometryAttribute({componentDatatype:l.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:w})),i.normal&&(s.attributes.normal=new u.GeometryAttribute({componentDatatype:l.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:T})),i.tangent&&(s.attributes.tangent=new u.GeometryAttribute({componentDatatype:l.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:I})),i.bitangent&&(s.attributes.bitangent=new u.GeometryAttribute({componentDatatype:l.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:A})),p&&(s.attributes.extrudeDirection=new u.GeometryAttribute({componentDatatype:l.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:x}))}if(t.extrude&&e.defined(t.offsetAttribute)){var ce=c.length/3,ye=new Uint8Array(ce);if(t.offsetAttribute===f.GeometryOffsetAttribute.TOP)g&&m||d?ye=f.arrayFill(ye,1,0,ce/2):g&&(ye=f.arrayFill(ye,1));else{var de=t.offsetAttribute===f.GeometryOffsetAttribute.NONE?0:1;ye=f.arrayFill(ye,de)}s.attributes.applyOffset=new u.GeometryAttribute({componentDatatype:l.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:ye})}return s}var q=new o.Cartographic,K=new o.Cartographic,Z={westOverIDL:0,eastOverIDL:0},J=new x.EllipsoidGeodesic;function X(t,o,a,i,s){if(s=e.defaultValue(s,new n.Rectangle),!e.defined(t)||t.length<3)return s.west=0,s.north=0,s.south=0,s.east=0,s;if(a===T.ArcType.RHUMB)return n.Rectangle.fromCartesianArray(t,o,s);J.ellipsoid.equals(o)||(J=new x.EllipsoidGeodesic(void 0,void 0,o)),s.west=Number.POSITIVE_INFINITY,s.east=Number.NEGATIVE_INFINITY,s.south=Number.POSITIVE_INFINITY,s.north=Number.NEGATIVE_INFINITY,Z.westOverIDL=Number.POSITIVE_INFINITY,Z.eastOverIDL=Number.NEGATIVE_INFINITY;for(var l,u=1/r.CesiumMath.chordLength(i,o.maximumRadius),p=t.length,c=o.cartesianToCartographic(t[0],K),y=q,d=1;d<p;d++)l=y,y=c,c=o.cartesianToCartographic(t[d],l),J.setEndPoints(y,c),ee(J,u,s,Z);return l=y,y=c,c=o.cartesianToCartographic(t[0],l),J.setEndPoints(y,c),ee(J,u,s,Z),s.east-s.west>Z.eastOverIDL-Z.westOverIDL&&(s.west=Z.westOverIDL,s.east=Z.eastOverIDL,s.east>r.CesiumMath.PI&&(s.east=s.east-r.CesiumMath.TWO_PI),s.west>r.CesiumMath.PI&&(s.west=s.west-r.CesiumMath.TWO_PI)),s}var $=new o.Cartographic;function ee(e,t,o,a){for(var i=e.surfaceDistance,n=Math.ceil(i*t),s=n>0?i/(n-1):Number.POSITIVE_INFINITY,l=0,u=0;u<n;u++){var p=e.interpolateUsingSurfaceDistance(l,$);l+=s;var c=p.longitude,y=p.latitude;o.west=Math.min(o.west,c),o.east=Math.max(o.east,c),o.south=Math.min(o.south,y),o.north=Math.max(o.north,y);var d=c>=0?c:c+r.CesiumMath.TWO_PI;a.westOverIDL=Math.min(a.westOverIDL,d),a.eastOverIDL=Math.max(a.eastOverIDL,d)}}var te=[];function re(e,t,r,o,a,i,n,s,l){var u,p={walls:[]};if(i||n){var c,y,d=A.PolygonGeometryLibrary.createGeometryFromPositions(e,t,r,a,s,l),m=d.attributes.position.values,h=d.indices;if(i&&n){var f=m.concat(m);c=f.length/3,(y=g.IndexDatatype.createTypedArray(c,2*h.length)).set(h);var b=h.length,_=c/2;for(u=0;u<b;u+=3){var P=y[u]+_,T=y[u+1]+_,w=y[u+2]+_;y[u+b]=w,y[u+1+b]=T,y[u+2+b]=P}if(d.attributes.position.values=f,a&&s.normal){var x=d.attributes.normal.values;d.attributes.normal.values=new Float32Array(f.length),d.attributes.normal.values.set(x)}d.indices=y}else if(n){for(c=m.length/3,y=g.IndexDatatype.createTypedArray(c,h.length),u=0;u<h.length;u+=3)y[u]=h[u+2],y[u+1]=h[u+1],y[u+2]=h[u];d.indices=y}p.topAndBottom=new v.GeometryInstance({geometry:d})}var E=o.outerRing,G=C.EllipsoidTangentPlane.fromPoints(E,e),O=G.projectPointsOntoPlane(E,te),H=I.PolygonPipeline.computeWindingOrder2D(O);H===I.WindingOrder.CLOCKWISE&&(E=E.slice().reverse());var D=A.PolygonGeometryLibrary.computeWallGeometry(E,e,r,a,l);p.walls.push(new v.GeometryInstance({geometry:D}));var V=o.holes;for(u=0;u<V.length;u++){var F=V[u];O=(G=C.EllipsoidTangentPlane.fromPoints(F,e)).projectPointsOntoPlane(F,te),(H=I.PolygonPipeline.computeWindingOrder2D(O))===I.WindingOrder.COUNTER_CLOCKWISE&&(F=F.slice().reverse()),D=A.PolygonGeometryLibrary.computeWallGeometry(F,e,r,a,l),p.walls.push(new v.GeometryInstance({geometry:D}))}return p}function oe(a){if(t.Check.typeOf.object("options",a),t.Check.typeOf.object("options.polygonHierarchy",a.polygonHierarchy),e.defined(a.perPositionHeight)&&a.perPositionHeight&&e.defined(a.height))throw new t.DeveloperError("Cannot use both options.perPositionHeight and options.height");if(e.defined(a.arcType)&&a.arcType!==T.ArcType.GEODESIC&&a.arcType!==T.ArcType.RHUMB)throw new t.DeveloperError("Invalid arcType. Valid options are ArcType.GEODESIC and ArcType.RHUMB.");var i=a.polygonHierarchy,n=e.defaultValue(a.vertexFormat,b.VertexFormat.DEFAULT),s=e.defaultValue(a.ellipsoid,o.Ellipsoid.WGS84),l=e.defaultValue(a.granularity,r.CesiumMath.RADIANS_PER_DEGREE),u=e.defaultValue(a.stRotation,0),p=e.defaultValue(a.perPositionHeight,!1),c=p&&e.defined(a.extrudedHeight),y=e.defaultValue(a.height,0),d=e.defaultValue(a.extrudedHeight,y);if(!c){var g=Math.max(y,d);d=Math.min(y,d),y=g}this._vertexFormat=b.VertexFormat.clone(n),this._ellipsoid=o.Ellipsoid.clone(s),this._granularity=l,this._stRotation=u,this._height=y,this._extrudedHeight=d,this._closeTop=e.defaultValue(a.closeTop,!0),this._closeBottom=e.defaultValue(a.closeBottom,!0),this._polygonHierarchy=i,this._perPositionHeight=p,this._perPositionHeightExtrude=c,this._shadowVolume=e.defaultValue(a.shadowVolume,!1),this._workerName="createPolygonGeometry",this._offsetAttribute=a.offsetAttribute,this._arcType=e.defaultValue(a.arcType,T.ArcType.GEODESIC),this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0,this.packedLength=A.PolygonGeometryLibrary.computeHierarchyPackedLength(i)+o.Ellipsoid.packedLength+b.VertexFormat.packedLength+12}oe.fromPositions=function(r){return r=e.defaultValue(r,e.defaultValue.EMPTY_OBJECT),t.Check.defined("options.positions",r.positions),new oe({polygonHierarchy:{positions:r.positions},height:r.height,extrudedHeight:r.extrudedHeight,vertexFormat:r.vertexFormat,stRotation:r.stRotation,ellipsoid:r.ellipsoid,granularity:r.granularity,perPositionHeight:r.perPositionHeight,closeTop:r.closeTop,closeBottom:r.closeBottom,offsetAttribute:r.offsetAttribute,arcType:r.arcType})},oe.pack=function(r,a,i){return t.Check.typeOf.object("value",r),t.Check.defined("array",a),i=e.defaultValue(i,0),i=A.PolygonGeometryLibrary.packPolygonHierarchy(r._polygonHierarchy,a,i),o.Ellipsoid.pack(r._ellipsoid,a,i),i+=o.Ellipsoid.packedLength,b.VertexFormat.pack(r._vertexFormat,a,i),i+=b.VertexFormat.packedLength,a[i++]=r._height,a[i++]=r._extrudedHeight,a[i++]=r._granularity,a[i++]=r._stRotation,a[i++]=r._perPositionHeightExtrude?1:0,a[i++]=r._perPositionHeight?1:0,a[i++]=r._closeTop?1:0,a[i++]=r._closeBottom?1:0,a[i++]=r._shadowVolume?1:0,a[i++]=e.defaultValue(r._offsetAttribute,-1),a[i++]=r._arcType,a[i]=r.packedLength,a};var ae=o.Ellipsoid.clone(o.Ellipsoid.UNIT_SPHERE),ie=new b.VertexFormat,ne={polygonHierarchy:{}};return oe.unpack=function(r,a,i){t.Check.defined("array",r),a=e.defaultValue(a,0);var n=A.PolygonGeometryLibrary.unpackPolygonHierarchy(r,a);a=n.startingIndex,delete n.startingIndex;var s=o.Ellipsoid.unpack(r,a,ae);a+=o.Ellipsoid.packedLength;var l=b.VertexFormat.unpack(r,a,ie);a+=b.VertexFormat.packedLength;var u=r[a++],p=r[a++],c=r[a++],y=r[a++],d=1===r[a++],g=1===r[a++],m=1===r[a++],h=1===r[a++],f=1===r[a++],v=r[a++],_=r[a++],P=r[a];return e.defined(i)||(i=new oe(ne)),i._polygonHierarchy=n,i._ellipsoid=o.Ellipsoid.clone(s,i._ellipsoid),i._vertexFormat=b.VertexFormat.clone(l,i._vertexFormat),i._height=u,i._extrudedHeight=p,i._granularity=c,i._stRotation=y,i._perPositionHeightExtrude=d,i._perPositionHeight=g,i._closeTop=m,i._closeBottom=h,i._shadowVolume=f,i._offsetAttribute=-1===v?void 0:v,i._arcType=_,i.packedLength=P,i},oe.computeRectangle=function(a,i){t.Check.typeOf.object("options",a),t.Check.typeOf.object("options.polygonHierarchy",a.polygonHierarchy);var n=e.defaultValue(a.granularity,r.CesiumMath.RADIANS_PER_DEGREE),s=e.defaultValue(a.arcType,T.ArcType.GEODESIC);if(s!==T.ArcType.GEODESIC&&s!==T.ArcType.RHUMB)throw new t.DeveloperError("Invalid arcType. Valid options are ArcType.GEODESIC and ArcType.RHUMB.");var l=a.polygonHierarchy,u=e.defaultValue(a.ellipsoid,o.Ellipsoid.WGS84);return X(l.positions,u,s,n,i)},oe.createGeometry=function(t){var o=t._vertexFormat,i=t._ellipsoid,n=t._granularity,s=t._stRotation,p=t._polygonHierarchy,c=t._perPositionHeight,d=t._closeTop,m=t._closeBottom,h=t._arcType,b=p.positions;if(!(b.length<3)){var _=C.EllipsoidTangentPlane.fromPoints(b,i),P=A.PolygonGeometryLibrary.polygonsFromHierarchy(p,_.projectPointsOntoPlane.bind(_),!c,i),T=P.hierarchy,w=P.polygons;if(0!==T.length){b=T[0].outerRing;var x,E=A.PolygonGeometryLibrary.computeBoundingRectangle(_.plane.normal,_.projectPointOntoPlane.bind(_),b,s,H),G=[],O=t._height,D=t._extrudedHeight,V={perPositionHeight:c,vertexFormat:o,geometry:void 0,tangentPlane:_,boundingRectangle:E,ellipsoid:i,stRotation:s,bottom:!1,top:!0,wall:!1,extrude:!1,arcType:h};if(t._perPositionHeightExtrude||!r.CesiumMath.equalsEpsilon(O,D,0,r.CesiumMath.EPSILON2))for(V.extrude=!0,V.top=d,V.bottom=m,V.shadowVolume=t._shadowVolume,V.offsetAttribute=t._offsetAttribute,x=0;x<w.length;x++){var F,L=re(i,w[x],n,T[x],c,d,m,o,h);d&&m?(F=L.topAndBottom,V.geometry=A.PolygonGeometryLibrary.scaleToGeodeticHeightExtruded(F.geometry,O,D,i,c)):d?((F=L.topAndBottom).geometry.attributes.position.values=I.PolygonPipeline.scaleToGeodeticHeight(F.geometry.attributes.position.values,O,i,!c),V.geometry=F.geometry):m&&((F=L.topAndBottom).geometry.attributes.position.values=I.PolygonPipeline.scaleToGeodeticHeight(F.geometry.attributes.position.values,D,i,!0),V.geometry=F.geometry),(d||m)&&(V.wall=!1,F.geometry=Q(V),G.push(F));var N=L.walls;V.wall=!0;for(var R=0;R<N.length;R++){var M=N[R];V.geometry=A.PolygonGeometryLibrary.scaleToGeodeticHeightExtruded(M.geometry,O,D,i,c),M.geometry=Q(V),G.push(M)}}else for(x=0;x<w.length;x++){var S=new v.GeometryInstance({geometry:A.PolygonGeometryLibrary.createGeometryFromPositions(i,w[x],n,c,o,h)});if(S.geometry.attributes.position.values=I.PolygonPipeline.scaleToGeodeticHeight(S.geometry.attributes.position.values,O,i,!c),V.geometry=S.geometry,S.geometry=Q(V),e.defined(t._offsetAttribute)){var k=S.geometry.attributes.position.values.length,B=new Uint8Array(k/3),z=t._offsetAttribute===f.GeometryOffsetAttribute.NONE?0:1;f.arrayFill(B,z),S.geometry.attributes.applyOffset=new u.GeometryAttribute({componentDatatype:l.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:B})}G.push(S)}var U=y.GeometryPipeline.combineInstances(G)[0];U.attributes.position.values=new Float64Array(U.attributes.position.values),U.indices=g.IndexDatatype.createTypedArray(U.attributes.position.values.length/3,U.indices);var W=U.attributes,Y=a.BoundingSphere.fromVertices(W.position.values);return o.position||delete W.position,new u.Geometry({attributes:W,indices:U.indices,primitiveType:U.primitiveType,boundingSphere:Y,offsetAttribute:t._offsetAttribute})}}},oe.createShadowVolume=function(e,t,r){var o=e._granularity,a=e._ellipsoid,i=t(o,a),n=r(o,a);return new oe({polygonHierarchy:e._polygonHierarchy,ellipsoid:a,stRotation:e._stRotation,granularity:o,perPositionHeight:!1,extrudedHeight:i,height:n,vertexFormat:b.VertexFormat.POSITION_ONLY,shadowVolume:!0,arcType:e._arcType})},Object.defineProperties(oe.prototype,{rectangle:{get:function(){if(!e.defined(this._rectangle)){var t=this._polygonHierarchy.positions;this._rectangle=X(t,this._ellipsoid,this._arcType,this._granularity)}return this._rectangle}},textureCoordinateRotationPoints:{get:function(){return e.defined(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){var t=-e._stRotation;if(0===t)return[0,0,0,1,1,0];var r=e._ellipsoid,o=e._polygonHierarchy.positions,a=e.rectangle;return u.Geometry._textureCoordinateRotationPoints(o,t,r,a)}(this)),this._textureCoordinateRotationPoints}}}),function(t,r){return e.defined(r)&&(t=oe.unpack(t,r)),t._ellipsoid=o.Ellipsoid.clone(t._ellipsoid),oe.createGeometry(t)}}));
//# sourceMappingURL=createPolygonGeometry.js.map
