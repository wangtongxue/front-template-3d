define(["./when-7ef6387a","./Check-ed6a1804","./Math-85667bf9","./Ellipsoid-1cbb4ac9","./Transforms-c20c38d0","./RuntimeError-5b606d78","./Cartesian2-73569d25","./WebGLConstants-30fc6f5c","./ComponentDatatype-a863af81","./AttributeCompression-5e3c38a2","./IndexDatatype-f12d39b5","./IntersectionTests-faaebeeb","./Plane-6ff6c057","./createTaskProcessorWorker","./EllipsoidTangentPlane-13a4f7fd","./OrientedBoundingBox-565e6407","./TerrainEncoding-a0f3ccb2"],(function(e,i,r,t,n,s,h,u,o,d,p,a,f,l,c,g,m){"use strict";var w={clipTriangleAtAxisAlignedThreshold:function(r,t,n,s,h,u){if(!e.defined(r))throw new i.DeveloperError("threshold is required.");if(!e.defined(t))throw new i.DeveloperError("keepAbove is required.");if(!e.defined(n))throw new i.DeveloperError("u0 is required.");if(!e.defined(s))throw new i.DeveloperError("u1 is required.");if(!e.defined(h))throw new i.DeveloperError("u2 is required.");var o,d,p;e.defined(u)?u.length=0:u=[],t?(o=n<r,d=s<r,p=h<r):(o=n>r,d=s>r,p=h>r);var a,f,l,c,g,m,w=o+d+p;return 1===w?o?(a=(r-n)/(s-n),f=(r-n)/(h-n),u.push(1),u.push(2),1!==f&&(u.push(-1),u.push(0),u.push(2),u.push(f)),1!==a&&(u.push(-1),u.push(0),u.push(1),u.push(a))):d?(l=(r-s)/(h-s),c=(r-s)/(n-s),u.push(2),u.push(0),1!==c&&(u.push(-1),u.push(1),u.push(0),u.push(c)),1!==l&&(u.push(-1),u.push(1),u.push(2),u.push(l))):p&&(g=(r-h)/(n-h),m=(r-h)/(s-h),u.push(0),u.push(1),1!==m&&(u.push(-1),u.push(2),u.push(1),u.push(m)),1!==g&&(u.push(-1),u.push(2),u.push(0),u.push(g))):2===w?o||n===r?d||s===r?p||h===r||(f=(r-n)/(h-n),l=(r-s)/(h-s),u.push(2),u.push(-1),u.push(0),u.push(2),u.push(f),u.push(-1),u.push(1),u.push(2),u.push(l)):(m=(r-h)/(s-h),a=(r-n)/(s-n),u.push(1),u.push(-1),u.push(2),u.push(1),u.push(m),u.push(-1),u.push(0),u.push(1),u.push(a)):(c=(r-s)/(n-s),g=(r-h)/(n-h),u.push(0),u.push(-1),u.push(1),u.push(0),u.push(c),u.push(-1),u.push(2),u.push(0),u.push(g)):3!==w&&(u.push(0),u.push(1),u.push(2)),u},computeBarycentricCoordinates:function(r,n,s,h,u,o,d,p,a){if(!e.defined(r))throw new i.DeveloperError("x is required.");if(!e.defined(n))throw new i.DeveloperError("y is required.");if(!e.defined(s))throw new i.DeveloperError("x1 is required.");if(!e.defined(h))throw new i.DeveloperError("y1 is required.");if(!e.defined(u))throw new i.DeveloperError("x2 is required.");if(!e.defined(o))throw new i.DeveloperError("y2 is required.");if(!e.defined(d))throw new i.DeveloperError("x3 is required.");if(!e.defined(p))throw new i.DeveloperError("y3 is required.");var f=s-d,l=d-u,c=o-p,g=h-p,m=1/(c*f+l*g),w=n-p,x=r-d,v=(c*x+l*w)*m,C=(-g*x+f*w)*m,y=1-v-C;return e.defined(a)?(a.x=v,a.y=C,a.z=y,a):new t.Cartesian3(v,C,y)},computeLineSegmentLineSegmentIntersection:function(r,t,n,s,u,o,d,p,a){i.Check.typeOf.number("x00",r),i.Check.typeOf.number("y00",t),i.Check.typeOf.number("x01",n),i.Check.typeOf.number("y01",s),i.Check.typeOf.number("x10",u),i.Check.typeOf.number("y10",o),i.Check.typeOf.number("x11",d),i.Check.typeOf.number("y11",p);var f=(p-o)*(n-r)-(d-u)*(s-t);if(0!==f){var l=((d-u)*(t-o)-(p-o)*(r-u))/f,c=((n-r)*(t-o)-(s-t)*(r-u))/f;return l>=0&&l<=1&&c>=0&&c<=1?(e.defined(a)||(a=new h.Cartesian2),a.x=r+l*(n-r),a.y=t+l*(s-t),a):void 0}}},x=[],v=[],C=[],y=new t.Cartographic,b=new t.Cartesian3,B=[],I=[],A=[],E=[],D=[],T=new t.Cartesian3,O=new n.BoundingSphere,z=new g.OrientedBoundingBox,k=new h.Cartesian2,M=new t.Cartesian3;function N(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}N.prototype.clone=function(i){return e.defined(i)||(i=new N),i.uBuffer=this.uBuffer,i.vBuffer=this.vBuffer,i.heightBuffer=this.heightBuffer,i.normalBuffer=this.normalBuffer,i.index=this.index,i.first=this.first,i.second=this.second,i.ratio=this.ratio,i},N.prototype.initializeIndexed=function(e,i,r,t,n){this.uBuffer=e,this.vBuffer=i,this.heightBuffer=r,this.normalBuffer=t,this.index=n,this.first=void 0,this.second=void 0,this.ratio=void 0},N.prototype.initializeFromClipResult=function(e,i,r){var t=i+1;return-1!==e[i]?r[e[i]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=r[e[t]],++t,this.second=r[e[t]],++t,this.ratio=e[t],++t),t},N.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},N.prototype.isIndexed=function(){return e.defined(this.index)},N.prototype.getH=function(){return e.defined(this.index)?this.heightBuffer[this.index]:r.CesiumMath.lerp(this.first.getH(),this.second.getH(),this.ratio)},N.prototype.getU=function(){return e.defined(this.index)?this.uBuffer[this.index]:r.CesiumMath.lerp(this.first.getU(),this.second.getU(),this.ratio)},N.prototype.getV=function(){return e.defined(this.index)?this.vBuffer[this.index]:r.CesiumMath.lerp(this.first.getV(),this.second.getV(),this.ratio)};var V=new h.Cartesian2,q=-1,R=[new t.Cartesian3,new t.Cartesian3],H=[new t.Cartesian3,new t.Cartesian3];function S(e,i){++q;var r=R[q],n=H[q];return r=d.AttributeCompression.octDecode(e.first.getNormalX(),e.first.getNormalY(),r),n=d.AttributeCompression.octDecode(e.second.getNormalX(),e.second.getNormalY(),n),b=t.Cartesian3.lerp(r,n,e.ratio,b),t.Cartesian3.normalize(b,b),d.AttributeCompression.octEncode(b,i),--q,i}N.prototype.getNormalX=function(){return e.defined(this.index)?this.normalBuffer[2*this.index]:(V=S(this,V)).x},N.prototype.getNormalY=function(){return e.defined(this.index)?this.normalBuffer[2*this.index+1]:(V=S(this,V)).y};var U=[];function F(i,r,t,n,s,h,u,o,d){if(0!==u.length){for(var p=0,a=0;a<u.length;)a=U[p++].initializeFromClipResult(u,a,o);for(var f=0;f<p;++f){var l=U[f];if(l.isIndexed())l.newIndex=h[l.index],l.uBuffer=i,l.vBuffer=r,l.heightBuffer=t,d&&(l.normalBuffer=n);else{var c=l.getKey();if(e.defined(h[c]))l.newIndex=h[c];else{var g=i.length;i.push(l.getU()),r.push(l.getV()),t.push(l.getH()),d&&(n.push(l.getNormalX()),n.push(l.getNormalY())),l.newIndex=g,h[c]=g}}}3===p?(s.push(U[0].newIndex),s.push(U[1].newIndex),s.push(U[2].newIndex)):4===p&&(s.push(U[0].newIndex),s.push(U[1].newIndex),s.push(U[2].newIndex),s.push(U[0].newIndex),s.push(U[2].newIndex),s.push(U[3].newIndex))}}return U.push(new N),U.push(new N),U.push(new N),U.push(new N),l((function(e,i){var s=e.isEastChild,u=e.isNorthChild,o=s?16383:0,d=s?32767:16383,a=u?16383:0,f=u?32767:16383,l=B,c=I,V=A,q=D;l.length=0,c.length=0,V.length=0,q.length=0;var R=E;R.length=0;var H={},S=e.vertices,U=e.indices;U=U.subarray(0,e.indexCountWithoutSkirts);var P,W,X,K,L,Y=m.TerrainEncoding.clone(e.encoding),_=Y.hasVertexNormals,G=e.exaggeration,J=0,Z=e.vertexCountWithoutSkirts,j=e.minimumHeight,Q=e.maximumHeight,$=new Array(Z),ee=new Array(Z),ie=new Array(Z),re=_?new Array(2*Z):void 0;for(W=0,X=0;W<Z;++W,X+=2){var te=Y.decodeTextureCoordinates(S,W,k);if(P=Y.decodeHeight(S,W)/G,K=r.CesiumMath.clamp(32767*te.x|0,0,32767),L=r.CesiumMath.clamp(32767*te.y|0,0,32767),ie[W]=r.CesiumMath.clamp((P-j)/(Q-j)*32767|0,0,32767),K<20&&(K=0),L<20&&(L=0),32767-K<20&&(K=32767),32767-L<20&&(L=32767),$[W]=K,ee[W]=L,_){var ne=Y.getOctEncodedNormal(S,W,M);re[X]=ne.x,re[X+1]=ne.y}(s&&K>=16383||!s&&K<=16383)&&(u&&L>=16383||!u&&L<=16383)&&(H[W]=J,l.push(K),c.push(L),V.push(ie[W]),_&&(q.push(re[X]),q.push(re[X+1])),++J)}var se=[];se.push(new N),se.push(new N),se.push(new N);var he,ue=[];for(ue.push(new N),ue.push(new N),ue.push(new N),W=0;W<U.length;W+=3){var oe=U[W],de=U[W+1],pe=U[W+2],ae=$[oe],fe=$[de],le=$[pe];se[0].initializeIndexed($,ee,ie,re,oe),se[1].initializeIndexed($,ee,ie,re,de),se[2].initializeIndexed($,ee,ie,re,pe);var ce=w.clipTriangleAtAxisAlignedThreshold(16383,s,ae,fe,le,x);(he=0)>=ce.length||((he=ue[0].initializeFromClipResult(ce,he,se))>=ce.length||(he=ue[1].initializeFromClipResult(ce,he,se))>=ce.length||(he=ue[2].initializeFromClipResult(ce,he,se),F(l,c,V,q,R,H,w.clipTriangleAtAxisAlignedThreshold(16383,u,ue[0].getV(),ue[1].getV(),ue[2].getV(),v),ue,_),he<ce.length&&(ue[2].clone(ue[1]),ue[2].initializeFromClipResult(ce,he,se),F(l,c,V,q,R,H,w.clipTriangleAtAxisAlignedThreshold(16383,u,ue[0].getV(),ue[1].getV(),ue[2].getV(),v),ue,_))))}var ge=s?-32767:0,me=u?-32767:0,we=[],xe=[],ve=[],Ce=[],ye=Number.MAX_VALUE,be=-ye,Be=C;Be.length=0;var Ie=t.Ellipsoid.clone(e.ellipsoid),Ae=h.Rectangle.clone(e.childRectangle),Ee=Ae.north,De=Ae.south,Te=Ae.east,Oe=Ae.west;for(Te<Oe&&(Te+=r.CesiumMath.TWO_PI),W=0;W<l.length;++W)(K=Math.round(l[W]))<=o?(we.push(W),K=0):K>=d?(ve.push(W),K=32767):K=2*K+ge,l[W]=K,(L=Math.round(c[W]))<=a?(xe.push(W),L=0):L>=f?(Ce.push(W),L=32767):L=2*L+me,c[W]=L,(P=r.CesiumMath.lerp(j,Q,V[W]/32767))<ye&&(ye=P),P>be&&(be=P),V[W]=P,y.longitude=r.CesiumMath.lerp(Oe,Te,K/32767),y.latitude=r.CesiumMath.lerp(De,Ee,L/32767),y.height=P,Ie.cartographicToCartesian(y,b),Be.push(b.x),Be.push(b.y),Be.push(b.z);var ze=n.BoundingSphere.fromVertices(Be,t.Cartesian3.ZERO,3,O),ke=g.OrientedBoundingBox.fromRectangle(Ae,ye,be,Ie,z),Me=new m.EllipsoidalOccluder(Ie).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(ze.center,Be,3,ze.center,ye,T),Ne=be-ye,Ve=new Uint16Array(l.length+c.length+V.length);for(W=0;W<l.length;++W)Ve[W]=l[W];var qe=l.length;for(W=0;W<c.length;++W)Ve[qe+W]=c[W];for(qe+=c.length,W=0;W<V.length;++W)Ve[qe+W]=32767*(V[W]-ye)/Ne;var Re,He=p.IndexDatatype.createTypedArray(l.length,R);if(_){var Se=new Uint8Array(q);i.push(Ve.buffer,He.buffer,Se.buffer),Re=Se.buffer}else i.push(Ve.buffer,He.buffer);return{vertices:Ve.buffer,encodedNormals:Re,indices:He.buffer,minimumHeight:ye,maximumHeight:be,westIndices:we,southIndices:xe,eastIndices:ve,northIndices:Ce,boundingSphere:ze,orientedBoundingBox:ke,horizonOcclusionPoint:Me}}))}));
//# sourceMappingURL=upsampleQuantizedTerrainMesh.js.map
