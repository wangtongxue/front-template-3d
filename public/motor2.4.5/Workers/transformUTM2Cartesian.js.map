{"version":3,"file":"transformUTM2Cartesian.js","sources":["../../../../Source/WorkersES6/transformUTM2Cartesian.js"],"sourcesContent":["/* global require */\r\nimport defined from '../Core/defined.js';\r\nimport createTaskProcessorWorker from './createTaskProcessorWorker.js';\r\n\r\nvar transformModule;\r\nfunction gotoTransform(parameters) {\r\n    // var dCenX = parameters.dCenX;\r\n    // var dCenY = parameters.dCenY;\r\n    // var dCenZ = parameters.dCenZ;\r\n    // var dCenX = 121.539794;\r\n    // var dCenY = 31.223272;\r\n    // var dCenZ = 0.0;\r\n    var typedArray = parameters.array;\r\n    var origin = parameters.origin;\r\n    var longitude = origin[0];\r\n    var latitude = origin[1];\r\n    var height = origin[2];\r\n\r\n    const numBytes = typedArray.byteLength;\r\n    const ptr = transformModule._malloc(numBytes);\r\n    transformModule.HEAPF64.set(typedArray,ptr / 8);\r\n    var computeFunciton = transformModule.cwrap('compute_rel_utmmat_to_cartesianmat','number',['number','number','number','number']);\r\n    computeFunciton(longitude, latitude, height, ptr);\r\n\r\n    var result = {\r\n        matrix : transformModule.HEAPF64.subarray(ptr/8, ptr/8+typedArray.length )\r\n    };\r\n    transformModule._free(ptr);\r\n    return result;\r\n}\r\n\r\nfunction initWorker(currentModule) {\r\n    transformModule = currentModule;\r\n    self.onmessage = createTaskProcessorWorker(gotoTransform);\r\n    self.postMessage(true);\r\n}\r\n\r\nfunction transformUTM2Cartesian(event) {\r\n    var data = event.data;\r\n\r\n    // Expect the first message to be to load a web assembly module\r\n    var wasmConfig = data.webAssemblyConfig;\r\n    if (defined(wasmConfig)) {\r\n        // Require and compile WebAssembly module, or use fallback if not supported\r\n        return require([wasmConfig.modulePath], function(transformModule) {\r\n            if (defined(wasmConfig.wasmBinaryFile)) {\r\n                if (!defined(transformModule)) {\r\n                    transformModule = self.Module;\r\n                }\r\n                transformModule(wasmConfig).then(function (compiledModule) {\r\n                    initWorker(compiledModule);\r\n                });\r\n            } else {\r\n                initWorker(transformModule());\r\n            }\r\n        });\r\n    }\r\n}\r\nexport default transformUTM2Cartesian;\r\n"],"names":["defined"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;IAAA;AAGA;IACA,IAAI,eAAe,CAAC;IACpB,SAAS,aAAa,CAAC,UAAU,EAAE;IACnC;IACA;IACA;IACA;IACA;IACA;IACA,IAAI,IAAI,UAAU,GAAG,UAAU,CAAC,KAAK,CAAC;IACtC,IAAI,IAAI,MAAM,GAAG,UAAU,CAAC,MAAM,CAAC;IACnC,IAAI,IAAI,SAAS,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;IAC9B,IAAI,IAAI,QAAQ,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;IAC7B,IAAI,IAAI,MAAM,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;AAC3B;IACA,IAAI,MAAM,QAAQ,GAAG,UAAU,CAAC,UAAU,CAAC;IAC3C,IAAI,MAAM,GAAG,GAAG,eAAe,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;IAClD,IAAI,eAAe,CAAC,OAAO,CAAC,GAAG,CAAC,UAAU,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;IACpD,IAAI,IAAI,eAAe,GAAG,eAAe,CAAC,KAAK,CAAC,oCAAoC,CAAC,QAAQ,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC;IACrI,IAAI,eAAe,CAAC,SAAS,EAAE,QAAQ,EAAE,MAAM,EAAE,GAAG,CAAC,CAAC;AACtD;IACA,IAAI,IAAI,MAAM,GAAG;IACjB,QAAQ,MAAM,GAAG,eAAe,CAAC,OAAO,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,UAAU,CAAC,MAAM,EAAE;IAClF,KAAK,CAAC;IACN,IAAI,eAAe,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;IAC/B,IAAI,OAAO,MAAM,CAAC;IAClB,CAAC;AACD;IACA,SAAS,UAAU,CAAC,aAAa,EAAE;IACnC,IAAI,eAAe,GAAG,aAAa,CAAC;IACpC,IAAI,IAAI,CAAC,SAAS,GAAG,yBAAyB,CAAC,aAAa,CAAC,CAAC;IAC9D,IAAI,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;IAC3B,CAAC;AACD;IACA,SAAS,sBAAsB,CAAC,KAAK,EAAE;IACvC,IAAI,IAAI,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC;AAC1B;IACA;IACA,IAAI,IAAI,UAAU,GAAG,IAAI,CAAC,iBAAiB,CAAC;IAC5C,IAAI,IAAIA,YAAO,CAAC,UAAU,CAAC,EAAE;IAC7B;IACA,QAAQ,OAAO,OAAO,CAAC,CAAC,UAAU,CAAC,UAAU,CAAC,EAAE,SAAS,eAAe,EAAE;IAC1E,YAAY,IAAIA,YAAO,CAAC,UAAU,CAAC,cAAc,CAAC,EAAE;IACpD,gBAAgB,IAAI,CAACA,YAAO,CAAC,eAAe,CAAC,EAAE;IAC/C,oBAAoB,eAAe,GAAG,IAAI,CAAC,MAAM,CAAC;IAClD,iBAAiB;IACjB,gBAAgB,eAAe,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,UAAU,cAAc,EAAE;IAC3E,oBAAoB,UAAU,CAAC,cAAc,CAAC,CAAC;IAC/C,iBAAiB,CAAC,CAAC;IACnB,aAAa,MAAM;IACnB,gBAAgB,UAAU,CAAC,eAAe,EAAE,CAAC,CAAC;IAC9C,aAAa;IACb,SAAS,CAAC,CAAC;IACX,KAAK;IACL;;;;;;;;"}