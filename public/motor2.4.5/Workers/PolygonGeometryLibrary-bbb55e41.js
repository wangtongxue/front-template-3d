define(["exports","./when-7ef6387a","./Math-85667bf9","./Ellipsoid-1cbb4ac9","./Transforms-c20c38d0","./Cartesian2-73569d25","./ComponentDatatype-a863af81","./GeometryAttribute-6b3c7112","./GeometryAttributes-cb18da36","./GeometryPipeline-585f444f","./IndexDatatype-f12d39b5","./arrayRemoveDuplicates-9458abce","./ArcType-2ee8dfbb","./EllipsoidRhumbLine-01425f3c","./PolygonPipeline-5110db34"],(function(e,t,r,i,n,a,o,s,u,l,h,c,f,p,d){"use strict";function y(){this._array=[],this._offset=0,this._length=0}Object.defineProperties(y.prototype,{length:{get:function(){return this._length}}}),y.prototype.enqueue=function(e){this._array.push(e),this._length++},y.prototype.dequeue=function(){if(0!==this._length){var e=this._array,t=this._offset,r=e[t];return e[t]=void 0,++t>10&&2*t>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,r}},y.prototype.peek=function(){if(0!==this._length)return this._array[this._offset]},y.prototype.contains=function(e){return-1!==this._array.indexOf(e)},y.prototype.clear=function(){this._array.length=this._offset=this._length=0},y.prototype.sort=function(e){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)};var g={computeHierarchyPackedLength:function(e){for(var r=0,n=[e];n.length>0;){var a=n.pop();if(t.defined(a)){r+=2;var o=a.positions,s=a.holes;if(t.defined(o)&&(r+=o.length*i.Cartesian3.packedLength),t.defined(s))for(var u=s.length,l=0;l<u;++l)n.push(s[l])}}return r},packPolygonHierarchy:function(e,r,n){for(var a=[e];a.length>0;){var o=a.pop();if(t.defined(o)){var s=o.positions,u=o.holes;if(r[n++]=t.defined(s)?s.length:0,r[n++]=t.defined(u)?u.length:0,t.defined(s))for(var l=s.length,h=0;h<l;++h,n+=3)i.Cartesian3.pack(s[h],r,n);if(t.defined(u))for(var c=u.length,f=0;f<c;++f)a.push(u[f])}}return n},unpackPolygonHierarchy:function(e,t){for(var r=e[t++],n=e[t++],a=new Array(r),o=n>0?new Array(n):void 0,s=0;s<r;++s,t+=i.Cartesian3.packedLength)a[s]=i.Cartesian3.unpack(e,t);for(var u=0;u<n;++u)o[u]=g.unpackPolygonHierarchy(e,t),t=o[u].startingIndex,delete o[u].startingIndex;return{positions:a,holes:o,startingIndex:t}}},v=new i.Cartesian3;function m(e,t,r,n){return i.Cartesian3.subtract(t,e,v),i.Cartesian3.multiplyByScalar(v,r/n,v),i.Cartesian3.add(e,v,v),[v.x,v.y,v.z]}g.subdivideLineCount=function(e,t,n){var a=i.Cartesian3.distance(e,t)/n,o=Math.max(0,Math.ceil(r.CesiumMath.log2(a)));return Math.pow(2,o)};var C=new i.Cartographic,b=new i.Cartographic,w=new i.Cartographic,T=new i.Cartesian3;g.subdivideRhumbLineCount=function(e,t,i,n){var a=e.cartesianToCartographic(t,C),o=e.cartesianToCartographic(i,b),s=new p.EllipsoidRhumbLine(a,o,e).surfaceDistance/n,u=Math.max(0,Math.ceil(r.CesiumMath.log2(s)));return Math.pow(2,u)},g.subdivideLine=function(e,r,n,a){var o=g.subdivideLineCount(e,r,n),s=i.Cartesian3.distance(e,r),u=s/o;t.defined(a)||(a=[]);var l=a;l.length=3*o;for(var h=0,c=0;c<o;c++){var f=m(e,r,c*u,s);l[h++]=f[0],l[h++]=f[1],l[h++]=f[2]}return l},g.subdivideRhumbLine=function(e,i,n,a,o){var s=e.cartesianToCartographic(i,C),u=e.cartesianToCartographic(n,b),l=new p.EllipsoidRhumbLine(s,u,e),h=l.surfaceDistance/a,c=Math.max(0,Math.ceil(r.CesiumMath.log2(h))),f=Math.pow(2,c),d=l.surfaceDistance/f;t.defined(o)||(o=[]);var y=o;y.length=3*f;for(var g=0,v=0;v<f;v++){var m=l.interpolateUsingSurfaceDistance(v*d,w),I=e.cartographicToCartesian(m,T);y[g++]=I.x,y[g++]=I.y,y[g++]=I.z}return y};var I=new i.Cartesian3,E=new i.Cartesian3,x=new i.Cartesian3,A=new i.Cartesian3;g.scaleToGeodeticHeightExtruded=function(e,r,n,a,o){a=t.defaultValue(a,i.Ellipsoid.WGS84);var s=I,u=E,l=x,h=A;if(t.defined(e)&&t.defined(e.attributes)&&t.defined(e.attributes.position))for(var c=e.attributes.position.values,f=c.length/2,p=0;p<f;p+=3)i.Cartesian3.fromArray(c,p,l),a.geodeticSurfaceNormal(l,s),h=a.scaleToGeodeticSurface(l,h),u=i.Cartesian3.multiplyByScalar(s,n,u),u=i.Cartesian3.add(h,u,u),c[p+f]=u.x,c[p+1+f]=u.y,c[p+2+f]=u.z,o&&(h=i.Cartesian3.clone(l,h)),u=i.Cartesian3.multiplyByScalar(s,r,u),u=i.Cartesian3.add(h,u,u),c[p]=u.x,c[p+1]=u.y,c[p+2]=u.z;return e},g.polygonOutlinesFromHierarchy=function(e,r,n){var a,o,s,u=[],l=new y;for(l.enqueue(e);0!==l.length;){var h=l.dequeue(),f=h.positions;if(r)for(s=f.length,a=0;a<s;a++)n.scaleToGeodeticSurface(f[a],f[a]);if(!((f=c.arrayRemoveDuplicates(f,i.Cartesian3.equalsEpsilon,!0)).length<3)){var p=h.holes?h.holes.length:0;for(a=0;a<p;a++){var d=h.holes[a],g=d.positions;if(r)for(s=g.length,o=0;o<s;++o)n.scaleToGeodeticSurface(g[o],g[o]);if(!((g=c.arrayRemoveDuplicates(g,i.Cartesian3.equalsEpsilon,!0)).length<3)){u.push(g);var v=0;for(t.defined(d.holes)&&(v=d.holes.length),o=0;o<v;o++)l.enqueue(d.holes[o])}}u.push(f)}}return u},g.polygonsFromHierarchy=function(e,r,n,a){var o=[],s=[],u=new y;for(u.enqueue(e);0!==u.length;){var l,h,f=u.dequeue(),p=f.positions,g=f.holes;if(n)for(h=p.length,l=0;l<h;l++)a.scaleToGeodeticSurface(p[l],p[l]);if(!((p=c.arrayRemoveDuplicates(p,i.Cartesian3.equalsEpsilon,!0)).length<3)){var v=r(p);if(t.defined(v)){var m=[],C=d.PolygonPipeline.computeWindingOrder2D(v);C===d.WindingOrder.CLOCKWISE&&(v.reverse(),p=p.slice().reverse());var b,w=p.slice(),T=t.defined(g)?g.length:0,I=[];for(l=0;l<T;l++){var E=g[l],x=E.positions;if(n)for(h=x.length,b=0;b<h;++b)a.scaleToGeodeticSurface(x[b],x[b]);if(!((x=c.arrayRemoveDuplicates(x,i.Cartesian3.equalsEpsilon,!0)).length<3)){var A=r(x);if(t.defined(A)){(C=d.PolygonPipeline.computeWindingOrder2D(A))===d.WindingOrder.CLOCKWISE&&(A.reverse(),x=x.slice().reverse()),I.push(x),m.push(w.length),w=w.concat(x),v=v.concat(A);var P=0;for(t.defined(E.holes)&&(P=E.holes.length),b=0;b<P;b++)u.enqueue(E.holes[b])}}}o.push({outerRing:p,holes:I}),s.push({positions:w,positions2D:v,holes:m})}}}return{hierarchy:o,polygons:s}};var P=new a.Cartesian2,_=new i.Cartesian3,G=new n.Quaternion,L=new n.Matrix3;g.computeBoundingRectangle=function(e,r,a,o,s){for(var u=n.Quaternion.fromAxisAngle(e,o,G),l=n.Matrix3.fromQuaternion(u,L),h=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,f=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,d=a.length,y=0;y<d;++y){var g=i.Cartesian3.clone(a[y],_);n.Matrix3.multiplyByVector(l,g,g);var v=r(g,P);t.defined(v)&&(h=Math.min(h,v.x),c=Math.max(c,v.x),f=Math.min(f,v.y),p=Math.max(p,v.y))}return s.x=h,s.y=f,s.width=c-h,s.height=p-f,s},g.createGeometryFromPositions=function(e,t,r,i,n,a){var u=d.PolygonPipeline.triangulate(t.positions2D,t.holes);u.length<3&&(u=[0,1,2]);var h=t.positions;if(i){for(var c=h.length,p=new Array(3*c),y=0,g=0;g<c;g++){var v=h[g];p[y++]=v.x,p[y++]=v.y,p[y++]=v.z}var m=new s.Geometry({attributes:{position:new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:p})},indices:u,primitiveType:s.PrimitiveType.TRIANGLES});return n.normal?l.GeometryPipeline.computeNormal(m):m}return a===f.ArcType.GEODESIC?d.PolygonPipeline.computeSubdivision(e,h,u,r):a===f.ArcType.RHUMB?d.PolygonPipeline.computeRhumbLineSubdivision(e,h,u,r):void 0};var M=[],D=new i.Cartesian3,S=new i.Cartesian3;g.computeWallGeometry=function(e,t,n,a,l){var c,p,d,y,v,m=e.length,C=0;if(a)for(p=3*m*2,c=new Array(2*p),d=0;d<m;d++)y=e[d],v=e[(d+1)%m],c[C]=c[C+p]=y.x,c[++C]=c[C+p]=y.y,c[++C]=c[C+p]=y.z,c[++C]=c[C+p]=v.x,c[++C]=c[C+p]=v.y,c[++C]=c[C+p]=v.z,++C;else{var b=r.CesiumMath.chordLength(n,t.maximumRadius),w=0;if(l===f.ArcType.GEODESIC)for(d=0;d<m;d++)w+=g.subdivideLineCount(e[d],e[(d+1)%m],b);else if(l===f.ArcType.RHUMB)for(d=0;d<m;d++)w+=g.subdivideRhumbLineCount(t,e[d],e[(d+1)%m],b);for(p=3*(w+m),c=new Array(2*p),d=0;d<m;d++){var T;y=e[d],v=e[(d+1)%m],l===f.ArcType.GEODESIC?T=g.subdivideLine(y,v,b,M):l===f.ArcType.RHUMB&&(T=g.subdivideRhumbLine(t,y,v,b,M));for(var I=T.length,E=0;E<I;++E,++C)c[C]=T[E],c[C+p]=T[E];c[C]=v.x,c[C+p]=v.x,c[++C]=v.y,c[C+p]=v.y,c[++C]=v.z,c[C+p]=v.z,++C}}m=c.length;var x=h.IndexDatatype.createTypedArray(m/3,m-6*e.length),A=0;for(m/=6,d=0;d<m;d++){var P=d,_=P+1,G=P+m,L=G+1;y=i.Cartesian3.fromArray(c,3*P,D),v=i.Cartesian3.fromArray(c,3*_,S),i.Cartesian3.equalsEpsilon(y,v,r.CesiumMath.EPSILON10,r.CesiumMath.EPSILON10)||(x[A++]=P,x[A++]=G,x[A++]=_,x[A++]=_,x[A++]=G,x[A++]=L)}return new s.Geometry({attributes:new u.GeometryAttributes({position:new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:c})}),indices:x,primitiveType:s.PrimitiveType.TRIANGLES})},e.PolygonGeometryLibrary=g}));
//# sourceMappingURL=PolygonGeometryLibrary-bbb55e41.js.map
