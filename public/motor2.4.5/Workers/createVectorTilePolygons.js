define(["./when-7ef6387a","./Check-ed6a1804","./Math-85667bf9","./Ellipsoid-1cbb4ac9","./Transforms-c20c38d0","./RuntimeError-5b606d78","./Cartesian2-73569d25","./WebGLConstants-30fc6f5c","./AttributeCompression-5e3c38a2","./IndexDatatype-f12d39b5","./IntersectionTests-faaebeeb","./Plane-6ff6c057","./createTaskProcessorWorker","./EllipsoidTangentPlane-13a4f7fd","./OrientedBoundingBox-565e6407","./Color-5decb6de"],(function(e,a,r,n,t,i,o,s,f,d,c,u,h,l,g,p){"use strict";var b=new n.Cartesian3,C=new n.Ellipsoid,v=new o.Rectangle,y={min:void 0,max:void 0,indexBytesPerElement:void 0};function I(e,a,r){var n=a.length,t=2+n*g.OrientedBoundingBox.packedLength+1+function(e){for(var a=e.length,r=0,n=0;n<a;++n)r+=p.Color.packedLength+3+e[n].batchIds.length;return r}(r),i=new Float64Array(t),o=0;i[o++]=e,i[o++]=n;for(var s=0;s<n;++s)g.OrientedBoundingBox.pack(a[s],i,o),o+=g.OrientedBoundingBox.packedLength;var f=r.length;i[o++]=f;for(var d=0;d<f;++d){var c=r[d];p.Color.pack(c.color,i,o),o+=p.Color.packedLength,i[o++]=c.offset,i[o++]=c.count;var u=c.batchIds,h=u.length;i[o++]=h;for(var l=0;l<h;++l)i[o++]=u[l]}return i}var m=new n.Cartesian3,w=new n.Cartesian3,x=new n.Cartesian3,A=new n.Cartesian3,E=new n.Cartesian3,N=new n.Cartographic,T=new o.Rectangle;return h((function(a,t){var i;!function(e){var a=new Float64Array(e),r=0;y.indexBytesPerElement=a[r++],y.min=a[r++],y.max=a[r++],n.Cartesian3.unpack(a,r,b),r+=n.Cartesian3.packedLength,n.Ellipsoid.unpack(a,r,C),r+=n.Ellipsoid.packedLength,o.Rectangle.unpack(a,r,v)}(a.packedBuffer),i=2===y.indexBytesPerElement?new Uint16Array(a.indices):new Uint32Array(a.indices);var s,c,u,h=new Uint16Array(a.positions),l=new Uint32Array(a.counts),k=new Uint32Array(a.indexCounts),B=new Uint32Array(a.batchIds),L=new Uint32Array(a.batchTableColors),O=new Array(l.length),U=b,P=C,F=v,S=y.min,R=y.max,D=a.minimumHeights,M=a.maximumHeights;e.defined(D)&&e.defined(M)&&(D=new Float32Array(D),M=new Float32Array(M));var _=h.length/2,G=h.subarray(0,_),Y=h.subarray(_,2*_);f.AttributeCompression.zigZagDeltaDecode(G,Y);var V=new Float64Array(3*_);for(s=0;s<_;++s){var H=G[s],W=Y[s],z=r.CesiumMath.lerp(F.west,F.east,H/32767),Z=r.CesiumMath.lerp(F.south,F.north,W/32767),j=n.Cartographic.fromRadians(z,Z,0,N),q=P.cartographicToCartesian(j,m);n.Cartesian3.pack(q,V,3*s)}var J=l.length,K=new Array(J),Q=new Array(J),X=0,$=0;for(s=0;s<J;++s)K[s]=X,Q[s]=$,X+=l[s],$+=k[s];var ee,ae=new Float32Array(3*_*2),re=new Uint16Array(2*_),ne=new Uint32Array(Q.length),te=new Uint32Array(k.length),ie=[],oe={};for(s=0;s<J;++s)u=L[s],e.defined(oe[u])?(oe[u].positionLength+=l[s],oe[u].indexLength+=k[s],oe[u].batchIds.push(s)):oe[u]={positionLength:l[s],indexLength:k[s],offset:0,indexOffset:0,batchIds:[s]};var se=0,fe=0;for(u in oe)if(oe.hasOwnProperty(u)){(ee=oe[u]).offset=se,ee.indexOffset=fe;var de=2*ee.positionLength,ce=2*ee.indexLength+6*ee.positionLength;se+=de,fe+=ce,ee.indexLength=ce}var ue=[];for(u in oe)oe.hasOwnProperty(u)&&(ee=oe[u],ue.push({color:p.Color.fromRgba(parseInt(u)),offset:ee.indexOffset,count:ee.indexLength,batchIds:ee.batchIds}));for(s=0;s<J;++s){var he=(ee=oe[u=L[s]]).offset,le=3*he,ge=he,pe=K[s],be=l[s],Ce=B[s],ve=S,ye=R;e.defined(D)&&e.defined(M)&&(ve=D[s],ye=M[s]);var Ie=Number.POSITIVE_INFINITY,me=Number.NEGATIVE_INFINITY,we=Number.POSITIVE_INFINITY,xe=Number.NEGATIVE_INFINITY;for(c=0;c<be;++c){var Ae=n.Cartesian3.unpack(V,3*pe+3*c,m);P.scaleToGeodeticSurface(Ae,Ae);var Ee=P.cartesianToCartographic(Ae,N),Ne=Ee.latitude,Te=Ee.longitude;Ie=Math.min(Ne,Ie),me=Math.max(Ne,me),we=Math.min(Te,we),xe=Math.max(Te,xe);var ke=P.geodeticSurfaceNormal(Ae,w),Be=n.Cartesian3.multiplyByScalar(ke,ve,x),Le=n.Cartesian3.add(Ae,Be,A);Be=n.Cartesian3.multiplyByScalar(ke,ye,Be);var Oe=n.Cartesian3.add(Ae,Be,E);n.Cartesian3.subtract(Oe,U,Oe),n.Cartesian3.subtract(Le,U,Le),n.Cartesian3.pack(Oe,ae,le),n.Cartesian3.pack(Le,ae,le+3),re[ge]=Ce,re[ge+1]=Ce,le+=6,ge+=2}(F=T).west=we,F.east=xe,F.south=Ie,F.north=me,O[s]=g.OrientedBoundingBox.fromRectangle(F,S,R,P);var Ue=ee.indexOffset,Pe=Q[s],Fe=k[s];for(ne[s]=Ue,c=0;c<Fe;c+=3){var Se=i[Pe+c]-pe,Re=i[Pe+c+1]-pe,De=i[Pe+c+2]-pe;ie[Ue++]=2*Se+he,ie[Ue++]=2*Re+he,ie[Ue++]=2*De+he,ie[Ue++]=2*De+1+he,ie[Ue++]=2*Re+1+he,ie[Ue++]=2*Se+1+he}for(c=0;c<be;++c){var Me=c,_e=(c+1)%be;ie[Ue++]=2*Me+1+he,ie[Ue++]=2*_e+he,ie[Ue++]=2*Me+he,ie[Ue++]=2*Me+1+he,ie[Ue++]=2*_e+1+he,ie[Ue++]=2*_e+he}ee.offset+=2*be,ee.indexOffset=Ue,te[s]=Ue-ne[s]}ie=d.IndexDatatype.createTypedArray(ae.length/3,ie);for(var Ge=ue.length,Ye=0;Ye<Ge;++Ye){for(var Ve=ue[Ye].batchIds,He=0,We=Ve.length,ze=0;ze<We;++ze)He+=te[Ve[ze]];ue[Ye].count=He}var Ze=I(2===ie.BYTES_PER_ELEMENT?d.IndexDatatype.UNSIGNED_SHORT:d.IndexDatatype.UNSIGNED_INT,O,ue);return t.push(ae.buffer,ie.buffer,ne.buffer,te.buffer,re.buffer,Ze.buffer),{positions:ae.buffer,indices:ie.buffer,indexOffsets:ne.buffer,indexCounts:te.buffer,batchIds:re.buffer,packedBuffer:Ze.buffer}}))}));
//# sourceMappingURL=createVectorTilePolygons.js.map
