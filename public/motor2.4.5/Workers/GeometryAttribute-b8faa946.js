/**
 * Cesium - https://github.com/AnalyticalGraphicsInc/cesium
 *
 * Copyright 2011-2017 Cesium Contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Columbus View (Pat. Pend.)
 *
 * Portions licensed separately.
 * See https://github.com/AnalyticalGraphicsInc/cesium/blob/master/LICENSE.md for full licensing details.
 */
define(["exports","./when-4ca4e419","./Check-430b3551","./defineProperties-163ddb68","./Cartesian3-32451e63","./Ellipsoid-d2aa3b12","./Transforms-7b04d7e0","./Matrix4-33464f2b","./Cartesian2-f49a1383","./WebGLConstants-2ddfa2f9"],(function(e,t,r,n,a,i,o,u,c,s){"use strict";var f=t.freezeObject({NONE:0,TOP:1,ALL:2}),l=t.freezeObject({NONE:0,TRIANGLES:1,LINES:2,POLYLINES:3});function h(e,r,n,a){this[0]=t.defaultValue(e,0),this[1]=t.defaultValue(n,0),this[2]=t.defaultValue(r,0),this[3]=t.defaultValue(a,0)}h.packedLength=4,h.pack=function(e,n,a){return r.Check.typeOf.object("value",e),r.Check.defined("array",n),a=t.defaultValue(a,0),n[a++]=e[0],n[a++]=e[1],n[a++]=e[2],n[a++]=e[3],n},h.unpack=function(e,n,a){return r.Check.defined("array",e),n=t.defaultValue(n,0),t.defined(a)||(a=new h),a[0]=e[n++],a[1]=e[n++],a[2]=e[n++],a[3]=e[n++],a},h.clone=function(e,r){if(t.defined(e))return t.defined(r)?(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r):new h(e[0],e[2],e[1],e[3])},h.fromArray=function(e,n,a){return r.Check.defined("array",e),n=t.defaultValue(n,0),t.defined(a)||(a=new h),a[0]=e[n],a[1]=e[n+1],a[2]=e[n+2],a[3]=e[n+3],a},h.fromColumnMajorArray=function(e,t){return r.Check.defined("values",e),h.clone(e,t)},h.fromRowMajorArray=function(e,n){return r.Check.defined("values",e),t.defined(n)?(n[0]=e[0],n[1]=e[2],n[2]=e[1],n[3]=e[3],n):new h(e[0],e[1],e[2],e[3])},h.fromScale=function(e,n){return r.Check.typeOf.object("scale",e),t.defined(n)?(n[0]=e.x,n[1]=0,n[2]=0,n[3]=e.y,n):new h(e.x,0,0,e.y)},h.fromUniformScale=function(e,n){return r.Check.typeOf.number("scale",e),t.defined(n)?(n[0]=e,n[1]=0,n[2]=0,n[3]=e,n):new h(e,0,0,e)},h.fromRotation=function(e,n){r.Check.typeOf.number("angle",e);var a=Math.cos(e),i=Math.sin(e);return t.defined(n)?(n[0]=a,n[1]=i,n[2]=-i,n[3]=a,n):new h(a,-i,i,a)},h.toArray=function(e,n){return r.Check.typeOf.object("matrix",e),t.defined(n)?(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n):[e[0],e[1],e[2],e[3]]},h.getElementIndex=function(e,t){return r.Check.typeOf.number.greaterThanOrEquals("row",t,0),r.Check.typeOf.number.lessThanOrEquals("row",t,1),r.Check.typeOf.number.greaterThanOrEquals("column",e,0),r.Check.typeOf.number.lessThanOrEquals("column",e,1),2*e+t},h.getColumn=function(e,t,n){r.Check.typeOf.object("matrix",e),r.Check.typeOf.number.greaterThanOrEquals("index",t,0),r.Check.typeOf.number.lessThanOrEquals("index",t,1),r.Check.typeOf.object("result",n);var a=2*t,i=e[a],o=e[a+1];return n.x=i,n.y=o,n},h.setColumn=function(e,t,n,a){r.Check.typeOf.object("matrix",e),r.Check.typeOf.number.greaterThanOrEquals("index",t,0),r.Check.typeOf.number.lessThanOrEquals("index",t,1),r.Check.typeOf.object("cartesian",n),r.Check.typeOf.object("result",a);var i=2*t;return(a=h.clone(e,a))[i]=n.x,a[i+1]=n.y,a},h.getRow=function(e,t,n){r.Check.typeOf.object("matrix",e),r.Check.typeOf.number.greaterThanOrEquals("index",t,0),r.Check.typeOf.number.lessThanOrEquals("index",t,1),r.Check.typeOf.object("result",n);var a=e[t],i=e[t+2];return n.x=a,n.y=i,n},h.setRow=function(e,t,n,a){return r.Check.typeOf.object("matrix",e),r.Check.typeOf.number.greaterThanOrEquals("index",t,0),r.Check.typeOf.number.lessThanOrEquals("index",t,1),r.Check.typeOf.object("cartesian",n),r.Check.typeOf.object("result",a),(a=h.clone(e,a))[t]=n.x,a[t+2]=n.y,a};var p=new c.Cartesian2;h.getScale=function(e,t){return r.Check.typeOf.object("matrix",e),r.Check.typeOf.object("result",t),t.x=c.Cartesian2.magnitude(c.Cartesian2.fromElements(e[0],e[1],p)),t.y=c.Cartesian2.magnitude(c.Cartesian2.fromElements(e[2],e[3],p)),t};var y=new c.Cartesian2;h.getMaximumScale=function(e){return h.getScale(e,y),c.Cartesian2.maximumComponent(y)},h.multiply=function(e,t,n){r.Check.typeOf.object("left",e),r.Check.typeOf.object("right",t),r.Check.typeOf.object("result",n);var a=e[0]*t[0]+e[2]*t[1],i=e[0]*t[2]+e[2]*t[3],o=e[1]*t[0]+e[3]*t[1],u=e[1]*t[2]+e[3]*t[3];return n[0]=a,n[1]=o,n[2]=i,n[3]=u,n},h.add=function(e,t,n){return r.Check.typeOf.object("left",e),r.Check.typeOf.object("right",t),r.Check.typeOf.object("result",n),n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n},h.subtract=function(e,t,n){return r.Check.typeOf.object("left",e),r.Check.typeOf.object("right",t),r.Check.typeOf.object("result",n),n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n},h.multiplyByVector=function(e,t,n){r.Check.typeOf.object("matrix",e),r.Check.typeOf.object("cartesian",t),r.Check.typeOf.object("result",n);var a=e[0]*t.x+e[2]*t.y,i=e[1]*t.x+e[3]*t.y;return n.x=a,n.y=i,n},h.multiplyByScalar=function(e,t,n){return r.Check.typeOf.object("matrix",e),r.Check.typeOf.number("scalar",t),r.Check.typeOf.object("result",n),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n},h.multiplyByScale=function(e,t,n){return r.Check.typeOf.object("matrix",e),r.Check.typeOf.object("scale",t),r.Check.typeOf.object("result",n),n[0]=e[0]*t.x,n[1]=e[1]*t.x,n[2]=e[2]*t.y,n[3]=e[3]*t.y,n},h.negate=function(e,t){return r.Check.typeOf.object("matrix",e),r.Check.typeOf.object("result",t),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},h.transpose=function(e,t){r.Check.typeOf.object("matrix",e),r.Check.typeOf.object("result",t);var n=e[0],a=e[2],i=e[1],o=e[3];return t[0]=n,t[1]=a,t[2]=i,t[3]=o,t},h.abs=function(e,t){return r.Check.typeOf.object("matrix",e),r.Check.typeOf.object("result",t),t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t[3]=Math.abs(e[3]),t},h.equals=function(e,r){return e===r||t.defined(e)&&t.defined(r)&&e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]},h.equalsArray=function(e,t,r){return e[0]===t[r]&&e[1]===t[r+1]&&e[2]===t[r+2]&&e[3]===t[r+3]},h.equalsEpsilon=function(e,n,a){return r.Check.typeOf.number("epsilon",a),e===n||t.defined(e)&&t.defined(n)&&Math.abs(e[0]-n[0])<=a&&Math.abs(e[1]-n[1])<=a&&Math.abs(e[2]-n[2])<=a&&Math.abs(e[3]-n[3])<=a},h.IDENTITY=t.freezeObject(new h(1,0,0,1)),h.ZERO=t.freezeObject(new h(0,0,0,0)),h.COLUMN0ROW0=0,h.COLUMN0ROW1=1,h.COLUMN1ROW0=2,h.COLUMN1ROW1=3,n.defineProperties(h.prototype,{length:{get:function(){return h.packedLength}}}),h.prototype.clone=function(e){return h.clone(this,e)},h.prototype.equals=function(e){return h.equals(this,e)},h.prototype.equalsEpsilon=function(e,t){return h.equalsEpsilon(this,e,t)},h.prototype.toString=function(){return"("+this[0]+", "+this[2]+")\n("+this[1]+", "+this[3]+")"};var b={POINTS:s.WebGLConstants.POINTS,LINES:s.WebGLConstants.LINES,LINE_LOOP:s.WebGLConstants.LINE_LOOP,LINE_STRIP:s.WebGLConstants.LINE_STRIP,TRIANGLES:s.WebGLConstants.TRIANGLES,TRIANGLE_STRIP:s.WebGLConstants.TRIANGLE_STRIP,TRIANGLE_FAN:s.WebGLConstants.TRIANGLE_FAN,validate:function(e){return e===b.POINTS||e===b.LINES||e===b.LINE_LOOP||e===b.LINE_STRIP||e===b.TRIANGLES||e===b.TRIANGLE_STRIP||e===b.TRIANGLE_FAN}},C=t.freezeObject(b);function m(e){e=t.defaultValue(e,t.defaultValue.EMPTY_OBJECT),r.Check.typeOf.object("options.attributes",e.attributes),this.attributes=e.attributes,this.indices=e.indices,this.primitiveType=t.defaultValue(e.primitiveType,C.TRIANGLES),this.boundingSphere=e.boundingSphere,this.geometryType=t.defaultValue(e.geometryType,l.NONE),this.boundingSphereCV=e.boundingSphereCV,this.offsetAttribute=e.offsetAttribute}m.computeNumberOfVertices=function(e){r.Check.typeOf.object("geometry",e);var n=-1;for(var a in e.attributes)if(e.attributes.hasOwnProperty(a)&&t.defined(e.attributes[a])&&t.defined(e.attributes[a].values)){var i=e.attributes[a],o=i.values.length/i.componentsPerAttribute;if(n!==o&&-1!==n)throw new r.DeveloperError("All attribute lists must have the same number of attributes.");n=o}return n};var d=new i.Cartographic,O=new a.Cartesian3,k=new u.Matrix4,x=[new i.Cartographic,new i.Cartographic,new i.Cartographic],E=[new c.Cartesian2,new c.Cartesian2,new c.Cartesian2],T=[new c.Cartesian2,new c.Cartesian2,new c.Cartesian2],N=new a.Cartesian3,I=new o.Quaternion,w=new u.Matrix4,j=new h;m._textureCoordinateRotationPoints=function(e,t,r,n){var s,f=c.Rectangle.center(n,d),l=i.Cartographic.toCartesian(f,r,O),p=o.Transforms.eastNorthUpToFixedFrame(l,r,k),y=u.Matrix4.inverse(p,k),b=E,C=x;C[0].longitude=n.west,C[0].latitude=n.south,C[1].longitude=n.west,C[1].latitude=n.north,C[2].longitude=n.east,C[2].latitude=n.south;var m=N;for(s=0;s<3;s++)i.Cartographic.toCartesian(C[s],r,m),m=u.Matrix4.multiplyByPointAsVector(y,m,m),b[s].x=m.x,b[s].y=m.y;var g=o.Quaternion.fromAxisAngle(a.Cartesian3.UNIT_Z,-t,I),v=u.Matrix3.fromQuaternion(g,w),L=e.length,A=Number.POSITIVE_INFINITY,P=Number.POSITIVE_INFINITY,S=Number.NEGATIVE_INFINITY,M=Number.NEGATIVE_INFINITY;for(s=0;s<L;s++)m=u.Matrix4.multiplyByPointAsVector(y,e[s],m),m=u.Matrix3.multiplyByVector(v,m,m),A=Math.min(A,m.x),P=Math.min(P,m.y),S=Math.max(S,m.x),M=Math.max(M,m.y);var R=h.fromRotation(t,j),V=T;V[0].x=A,V[0].y=P,V[1].x=A,V[1].y=M,V[2].x=S,V[2].y=P;var G=b[0],q=b[2].x-G.x,_=b[1].y-G.y;for(s=0;s<3;s++){var W=V[s];h.multiplyByVector(R,W,W),W.x=(W.x-G.x)/q,W.y=(W.y-G.y)/_}var D=V[0],B=V[1],F=V[2],Y=new Array(6);return c.Cartesian2.pack(D,Y),c.Cartesian2.pack(B,Y,2),c.Cartesian2.pack(F,Y,4),Y},e.Geometry=m,e.GeometryAttribute=function(e){if(e=t.defaultValue(e,t.defaultValue.EMPTY_OBJECT),!t.defined(e.componentDatatype))throw new r.DeveloperError("options.componentDatatype is required.");if(!t.defined(e.componentsPerAttribute))throw new r.DeveloperError("options.componentsPerAttribute is required.");if(e.componentsPerAttribute<1||e.componentsPerAttribute>4)throw new r.DeveloperError("options.componentsPerAttribute must be between 1 and 4.");if(!t.defined(e.values))throw new r.DeveloperError("options.values is required.");this.componentDatatype=e.componentDatatype,this.componentsPerAttribute=e.componentsPerAttribute,this.normalize=t.defaultValue(e.normalize,!1),this.values=e.values},e.GeometryOffsetAttribute=f,e.GeometryType=l,e.Matrix2=h,e.PrimitiveType=C}));
