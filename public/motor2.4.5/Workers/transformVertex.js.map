{"version":3,"file":"transformVertex.js","sources":["../../../../Source/WorkersES6/transformVertex.js"],"sourcesContent":["/* global require */\r\nimport defined from '../Core/defined.js';\r\nimport createTaskProcessorWorker from './createTaskProcessorWorker.js';\r\n\r\nvar transformModule;\r\nfunction gotoTransform(parameters) {\r\n    var dCenX = parameters.dCenX;\r\n    var dCenY = parameters.dCenY;\r\n    var dCenZ = parameters.dCenZ;\r\n    // var dCenX = 121.539794;\r\n    // var dCenY = 31.223272;\r\n    // var dCenZ = 0.0;\r\n    var typedArray = parameters.array;\r\n    var iPtNum = typedArray.length;\r\n    var matrix = parameters.matrix;\r\n\r\n    const numBytes = typedArray.byteLength;\r\n    const ptr = transformModule._malloc(numBytes);\r\n    transformModule.HEAPF32.set(typedArray,ptr / 4);\r\n\r\n    const matrixPtr = transformModule._malloc(matrix.byteLength);\r\n    transformModule.HEAPF64.set(matrix,matrixPtr / 8);\r\n    var computeFunciton = transformModule.cwrap('compute_to_cartesian_pts','number',['number','number','number','number','number','number']);\r\n    computeFunciton(dCenX,dCenY,dCenZ,ptr,iPtNum,matrixPtr);\r\n\r\n    var resultAttributeData = new Float32Array(typedArray.length);\r\n    for(var index = 0; index < typedArray.length; ++index){\r\n        resultAttributeData[index] = transformModule.HEAPF32[(ptr>>2) + index];\r\n    }\r\n    var result = {\r\n        attributeData : resultAttributeData\r\n    };\r\n    transformModule._free(ptr);\r\n    return result;\r\n}\r\n\r\nfunction initWorker(currentModule) {\r\n    transformModule = currentModule;\r\n    self.onmessage = createTaskProcessorWorker(gotoTransform);\r\n    self.postMessage(true);\r\n}\r\n\r\nfunction transformVertex(event) {\r\n    var data = event.data;\r\n\r\n    // Expect the first message to be to load a web assembly module\r\n    var wasmConfig = data.webAssemblyConfig;\r\n    if (defined(wasmConfig)) {\r\n        // Require and compile WebAssembly module, or use fallback if not supported\r\n        return require([wasmConfig.modulePath], function(transformModule) {\r\n            if (defined(wasmConfig.wasmBinaryFile)) {\r\n                if (!defined(transformModule)) {\r\n                    transformModule = self.Module;\r\n                }\r\n                transformModule(wasmConfig).then(function (compiledModule) {\r\n                    initWorker(compiledModule);\r\n                });\r\n            } else {\r\n                initWorker(transformModule());\r\n            }\r\n        });\r\n    }\r\n}\r\nexport default transformVertex;\r\n"],"names":["defined"],"mappings":"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"}