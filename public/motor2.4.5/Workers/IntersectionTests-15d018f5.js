/**
 * Cesium - https://github.com/AnalyticalGraphicsInc/cesium
 *
 * Copyright 2011-2017 Cesium Contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Columbus View (Pat. Pend.)
 *
 * Portions licensed separately.
 * See https://github.com/AnalyticalGraphicsInc/cesium/blob/master/LICENSE.md for full licensing details.
 */
define(["exports","./when-4ca4e419","./Check-430b3551","./defineProperties-163ddb68","./Cartesian3-32451e63","./Ellipsoid-d2aa3b12","./Transforms-7b04d7e0","./Matrix4-33464f2b"],(function(e,r,t,a,i,n,o,s){"use strict";var u={};function d(e,r,t){var i=e+r;return a.CesiumMath.sign(e)!==a.CesiumMath.sign(r)&&Math.abs(i/Math.max(Math.abs(e),Math.abs(r)))<t?0:i}u.computeDiscriminant=function(e,r,a){if("number"!=typeof e)throw new t.DeveloperError("a is a required number.");if("number"!=typeof r)throw new t.DeveloperError("b is a required number.");if("number"!=typeof a)throw new t.DeveloperError("c is a required number.");return r*r-4*e*a},u.computeRealRoots=function(e,r,i){if("number"!=typeof e)throw new t.DeveloperError("a is a required number.");if("number"!=typeof r)throw new t.DeveloperError("b is a required number.");if("number"!=typeof i)throw new t.DeveloperError("c is a required number.");var n;if(0===e)return 0===r?[]:[-i/r];if(0===r){if(0===i)return[0,0];var o=Math.abs(i),s=Math.abs(e);if(o<s&&o/s<a.CesiumMath.EPSILON14)return[0,0];if(o>s&&s/o<a.CesiumMath.EPSILON14)return[];if((n=-i/e)<0)return[];var u=Math.sqrt(n);return[-u,u]}if(0===i)return(n=-r/e)<0?[n,0]:[0,n];var f=d(r*r,-(4*e*i),a.CesiumMath.EPSILON14);if(f<0)return[];var l=-.5*d(r,a.CesiumMath.sign(r)*Math.sqrt(f),a.CesiumMath.EPSILON14);return r>0?[l/e,i/l]:[i/l,l/e]};var f={};function l(e,r,t,a){var i,n,o=e,s=r/3,u=t/3,d=a,f=o*u,l=s*d,h=s*s,m=u*u,p=o*u-h,C=o*d-s*u,c=s*d-m,w=4*p*c-C*C;if(w<0){var v,M,b;h*l>=f*m?(v=o,M=p,b=-2*s*p+o*C):(v=d,M=c,b=-d*C+2*u*c);var g=-(b<0?-1:1)*Math.abs(v)*Math.sqrt(-w),q=(n=-b+g)/2,E=q<0?-Math.pow(-q,1/3):Math.pow(q,1/3),y=n===g?-E:-M/E;return i=M<=0?E+y:-b/(E*E+y*y+M),h*l>=f*m?[(i-s)/o]:[-d/(i+u)]}var D=p,R=-2*s*p+o*C,S=c,O=-d*C+2*u*c,x=Math.sqrt(w),P=Math.sqrt(3)/2,N=Math.abs(Math.atan2(o*x,-R)/3);i=2*Math.sqrt(-D);var L=Math.cos(N);n=i*L;var I=i*(-L/2-P*Math.sin(N)),z=n+I>2*s?n-s:I-s,T=o,U=z/T;N=Math.abs(Math.atan2(d*x,-O)/3);var W=-d,B=(n=(i=2*Math.sqrt(-S))*(L=Math.cos(N)))+(I=i*(-L/2-P*Math.sin(N)))<2*u?n+u:I+u,V=W/B,Z=-z*B-T*W,k=(u*Z-s*(z*W))/(-s*Z+u*(T*B));return U<=k?U<=V?k<=V?[U,k,V]:[U,V,k]:[V,U,k]:U<=V?[k,U,V]:k<=V?[k,V,U]:[V,k,U]}f.computeDiscriminant=function(e,r,a,i){if("number"!=typeof e)throw new t.DeveloperError("a is a required number.");if("number"!=typeof r)throw new t.DeveloperError("b is a required number.");if("number"!=typeof a)throw new t.DeveloperError("c is a required number.");if("number"!=typeof i)throw new t.DeveloperError("d is a required number.");var n=r*r,o=a*a;return 18*e*r*a*i+n*o-27*(e*e)*(i*i)-4*(e*o*a+n*r*i)},f.computeRealRoots=function(e,r,a,i){if("number"!=typeof e)throw new t.DeveloperError("a is a required number.");if("number"!=typeof r)throw new t.DeveloperError("b is a required number.");if("number"!=typeof a)throw new t.DeveloperError("c is a required number.");if("number"!=typeof i)throw new t.DeveloperError("d is a required number.");var n,o;if(0===e)return u.computeRealRoots(r,a,i);if(0===r){if(0===a){if(0===i)return[0,0,0];var s=(o=-i/e)<0?-Math.pow(-o,1/3):Math.pow(o,1/3);return[s,s,s]}return 0===i?0===(n=u.computeRealRoots(e,0,a)).Length?[0]:[n[0],0,n[1]]:l(e,0,a,i)}return 0===a?0===i?(o=-r/e)<0?[o,0,0]:[0,0,o]:l(e,r,0,i):0===i?0===(n=u.computeRealRoots(e,r,a)).length?[0]:n[1]<=0?[n[0],n[1],0]:n[0]>=0?[0,n[0],n[1]]:[n[0],0,n[1]]:l(e,r,a,i)};var h={};function m(e,r,t,i){var n=e*e,o=r-3*n/8,s=t-r*e/2+n*e/8,d=i-t*e/4+r*n/16-3*n*n/256,l=f.computeRealRoots(1,2*o,o*o-4*d,-s*s);if(l.length>0){var h=-e/4,m=l[l.length-1];if(Math.abs(m)<a.CesiumMath.EPSILON14){var p=u.computeRealRoots(1,o,d);if(2===p.length){var C,c=p[0],w=p[1];if(c>=0&&w>=0){var v=Math.sqrt(c),M=Math.sqrt(w);return[h-M,h-v,h+v,h+M]}if(c>=0&&w<0)return[h-(C=Math.sqrt(c)),h+C];if(c<0&&w>=0)return[h-(C=Math.sqrt(w)),h+C]}return[]}if(m>0){var b=Math.sqrt(m),g=(o+m-s/b)/2,q=(o+m+s/b)/2,E=u.computeRealRoots(1,b,g),y=u.computeRealRoots(1,-b,q);return 0!==E.length?(E[0]+=h,E[1]+=h,0!==y.length?(y[0]+=h,y[1]+=h,E[1]<=y[0]?[E[0],E[1],y[0],y[1]]:y[1]<=E[0]?[y[0],y[1],E[0],E[1]]:E[0]>=y[0]&&E[1]<=y[1]?[y[0],E[0],E[1],y[1]]:y[0]>=E[0]&&y[1]<=E[1]?[E[0],y[0],y[1],E[1]]:E[0]>y[0]&&E[0]<y[1]?[y[0],E[0],y[1],E[1]]:[E[0],y[0],E[1],y[1]]):E):0!==y.length?(y[0]+=h,y[1]+=h,y):[]}}return[]}function p(e,r,t,i){var n=e*e,o=-2*r,s=t*e+r*r-4*i,d=n*i-t*r*e+t*t,l=f.computeRealRoots(1,o,s,d);if(l.length>0){var h,m,p,C,c,w,v=l[0],M=r-v,b=M*M,g=e/2,q=M/2,E=b-4*i,y=b+4*Math.abs(i),D=n-4*v,R=n+4*Math.abs(v);if(v<0||E*R<D*y){var S=Math.sqrt(D);h=S/2,m=0===S?0:(e*q-t)/S}else{var O=Math.sqrt(E);h=0===O?0:(e*q-t)/O,m=O/2}0===g&&0===h?(p=0,C=0):a.CesiumMath.sign(g)===a.CesiumMath.sign(h)?C=v/(p=g+h):p=v/(C=g-h),0===q&&0===m?(c=0,w=0):a.CesiumMath.sign(q)===a.CesiumMath.sign(m)?w=i/(c=q+m):c=i/(w=q-m);var x=u.computeRealRoots(1,p,c),P=u.computeRealRoots(1,C,w);if(0!==x.length)return 0!==P.length?x[1]<=P[0]?[x[0],x[1],P[0],P[1]]:P[1]<=x[0]?[P[0],P[1],x[0],x[1]]:x[0]>=P[0]&&x[1]<=P[1]?[P[0],x[0],x[1],P[1]]:P[0]>=x[0]&&P[1]<=x[1]?[x[0],P[0],P[1],x[1]]:x[0]>P[0]&&x[0]<P[1]?[P[0],x[0],P[1],x[1]]:[x[0],P[0],x[1],P[1]]:x;if(0!==P.length)return P}return[]}function C(e,t){t=i.Cartesian3.clone(r.defaultValue(t,i.Cartesian3.ZERO)),i.Cartesian3.equals(t,i.Cartesian3.ZERO)||i.Cartesian3.normalize(t,t),this.origin=i.Cartesian3.clone(r.defaultValue(e,i.Cartesian3.ZERO)),this.direction=t}h.computeDiscriminant=function(e,r,a,i,n){if("number"!=typeof e)throw new t.DeveloperError("a is a required number.");if("number"!=typeof r)throw new t.DeveloperError("b is a required number.");if("number"!=typeof a)throw new t.DeveloperError("c is a required number.");if("number"!=typeof i)throw new t.DeveloperError("d is a required number.");if("number"!=typeof n)throw new t.DeveloperError("e is a required number.");var o=e*e,s=r*r,u=s*r,d=a*a,f=d*a,l=i*i,h=l*i,m=n*n;return s*d*l-4*u*h-4*e*f*l+18*e*r*a*h-27*o*l*l+256*(o*e)*(m*n)+n*(18*u*a*i-4*s*f+16*e*d*d-80*e*r*d*i-6*e*s*l+144*o*a*l)+m*(144*e*s*a-27*s*s-128*o*d-192*o*r*i)},h.computeRealRoots=function(e,r,i,n,o){if("number"!=typeof e)throw new t.DeveloperError("a is a required number.");if("number"!=typeof r)throw new t.DeveloperError("b is a required number.");if("number"!=typeof i)throw new t.DeveloperError("c is a required number.");if("number"!=typeof n)throw new t.DeveloperError("d is a required number.");if("number"!=typeof o)throw new t.DeveloperError("e is a required number.");if(Math.abs(e)<a.CesiumMath.EPSILON15)return f.computeRealRoots(r,i,n,o);var s=r/e,u=i/e,d=n/e,l=o/e,h=s<0?1:0;switch(h+=u<0?h+1:h,h+=d<0?h+1:h,h+=l<0?h+1:h){case 0:return m(s,u,d,l);case 1:case 2:return p(s,u,d,l);case 3:case 4:return m(s,u,d,l);case 5:return p(s,u,d,l);case 6:case 7:return m(s,u,d,l);case 8:return p(s,u,d,l);case 9:case 10:return m(s,u,d,l);case 11:return p(s,u,d,l);case 12:case 13:case 14:case 15:return m(s,u,d,l);default:return}},C.clone=function(e,t){if(r.defined(e))return r.defined(t)?(t.origin=i.Cartesian3.clone(e.origin),t.direction=i.Cartesian3.clone(e.direction),t):new C(e.origin,e.direction)},C.getPoint=function(e,a,n){return t.Check.typeOf.object("ray",e),t.Check.typeOf.number("t",a),r.defined(n)||(n=new i.Cartesian3),n=i.Cartesian3.multiplyByScalar(e.direction,a,n),i.Cartesian3.add(e.origin,n,n)};var c={rayPlane:function(e,n,o){if(!r.defined(e))throw new t.DeveloperError("ray is required.");if(!r.defined(n))throw new t.DeveloperError("plane is required.");r.defined(o)||(o=new i.Cartesian3);var s=e.origin,u=e.direction,d=n.normal,f=i.Cartesian3.dot(d,u);if(!(Math.abs(f)<a.CesiumMath.EPSILON15)){var l=(-n.distance-i.Cartesian3.dot(d,s))/f;if(!(l<0))return o=i.Cartesian3.multiplyByScalar(u,l,o),i.Cartesian3.add(s,o,o)}}},w=new i.Cartesian3,v=new i.Cartesian3,M=new i.Cartesian3,b=new i.Cartesian3,g=new i.Cartesian3;c.rayTriangleParametric=function(e,n,o,s,u){if(!r.defined(e))throw new t.DeveloperError("ray is required.");if(!r.defined(n))throw new t.DeveloperError("p0 is required.");if(!r.defined(o))throw new t.DeveloperError("p1 is required.");if(!r.defined(s))throw new t.DeveloperError("p2 is required.");u=r.defaultValue(u,!1);var d,f,l,h,m,p=e.origin,C=e.direction,c=i.Cartesian3.subtract(o,n,w),q=i.Cartesian3.subtract(s,n,v),E=i.Cartesian3.cross(C,q,M),y=i.Cartesian3.dot(c,E);if(u){if(y<a.CesiumMath.EPSILON6)return;if(d=i.Cartesian3.subtract(p,n,b),(l=i.Cartesian3.dot(d,E))<0||l>y)return;if(f=i.Cartesian3.cross(d,c,g),(h=i.Cartesian3.dot(C,f))<0||l+h>y)return;m=i.Cartesian3.dot(q,f)/y}else{if(Math.abs(y)<a.CesiumMath.EPSILON6)return;var D=1/y;if(d=i.Cartesian3.subtract(p,n,b),(l=i.Cartesian3.dot(d,E)*D)<0||l>1)return;if(f=i.Cartesian3.cross(d,c,g),(h=i.Cartesian3.dot(C,f)*D)<0||l+h>1)return;m=i.Cartesian3.dot(q,f)*D}return m},c.rayTriangle=function(e,t,a,n,o,s){var u=c.rayTriangleParametric(e,t,a,n,o);if(r.defined(u)&&!(u<0))return r.defined(s)||(s=new i.Cartesian3),i.Cartesian3.multiplyByScalar(e.direction,u,s),i.Cartesian3.add(e.origin,s,s)};var q=new C;c.lineSegmentTriangle=function(e,a,n,o,s,u,d){if(!r.defined(e))throw new t.DeveloperError("v0 is required.");if(!r.defined(a))throw new t.DeveloperError("v1 is required.");if(!r.defined(n))throw new t.DeveloperError("p0 is required.");if(!r.defined(o))throw new t.DeveloperError("p1 is required.");if(!r.defined(s))throw new t.DeveloperError("p2 is required.");var f=q;i.Cartesian3.clone(e,f.origin),i.Cartesian3.subtract(a,e,f.direction),i.Cartesian3.normalize(f.direction,f.direction);var l=c.rayTriangleParametric(f,n,o,s,u);if(!(!r.defined(l)||l<0||l>i.Cartesian3.distance(e,a)))return r.defined(d)||(d=new i.Cartesian3),i.Cartesian3.multiplyByScalar(f.direction,l,d),i.Cartesian3.add(f.origin,d,d)};var E={root0:0,root1:0};function y(e,t,a){r.defined(a)||(a=new o.Interval);var n=e.origin,s=e.direction,u=t.center,d=t.radius*t.radius,f=i.Cartesian3.subtract(n,u,M),l=function(e,r,t,a){var i=r*r-4*e*t;if(!(i<0)){if(i>0){var n=1/(2*e),o=Math.sqrt(i),s=(-r+o)*n,u=(-r-o)*n;return s<u?(a.root0=s,a.root1=u):(a.root0=u,a.root1=s),a}var d=-r/(2*e);if(0!==d)return a.root0=a.root1=d,a}}(i.Cartesian3.dot(s,s),2*i.Cartesian3.dot(s,f),i.Cartesian3.magnitudeSquared(f)-d,E);if(r.defined(l))return a.start=l.root0,a.stop=l.root1,a}c.raySphere=function(e,a,i){if(!r.defined(e))throw new t.DeveloperError("ray is required.");if(!r.defined(a))throw new t.DeveloperError("sphere is required.");if(i=y(e,a,i),r.defined(i)&&!(i.stop<0))return i.start=Math.max(i.start,0),i};var D=new C;c.lineSegmentSphere=function(e,a,n,o){if(!r.defined(e))throw new t.DeveloperError("p0 is required.");if(!r.defined(a))throw new t.DeveloperError("p1 is required.");if(!r.defined(n))throw new t.DeveloperError("sphere is required.");var s=D;i.Cartesian3.clone(e,s.origin);var u=i.Cartesian3.subtract(a,e,s.direction),d=i.Cartesian3.magnitude(u);if(i.Cartesian3.normalize(u,u),o=y(s,n,o),!(!r.defined(o)||o.stop<0||o.start>d))return o.start=Math.max(o.start,0),o.stop=Math.min(o.stop,d),o};var R=new i.Cartesian3,S=new i.Cartesian3;function O(e,r,t){var i=e+r;return a.CesiumMath.sign(e)!==a.CesiumMath.sign(r)&&Math.abs(i/Math.max(Math.abs(e),Math.abs(r)))<t?0:i}c.rayEllipsoid=function(e,a){if(!r.defined(e))throw new t.DeveloperError("ray is required.");if(!r.defined(a))throw new t.DeveloperError("ellipsoid is required.");var n,s,u,d,f,l=a.oneOverRadii,h=i.Cartesian3.multiplyComponents(l,e.origin,R),m=i.Cartesian3.multiplyComponents(l,e.direction,S),p=i.Cartesian3.magnitudeSquared(h),C=i.Cartesian3.dot(h,m);if(p>1){if(C>=0)return;var c=C*C;if(n=p-1,c<(u=(s=i.Cartesian3.magnitudeSquared(m))*n))return;if(c>u){d=C*C-u;var w=(f=-C+Math.sqrt(d))/s,v=n/f;return w<v?new o.Interval(w,v):{start:v,stop:w}}var M=Math.sqrt(n/s);return new o.Interval(M,M)}return p<1?(n=p-1,d=C*C-(u=(s=i.Cartesian3.magnitudeSquared(m))*n),f=-C+Math.sqrt(d),new o.Interval(0,f/s)):C<0?(s=i.Cartesian3.magnitudeSquared(m),new o.Interval(0,-C/s)):void 0};var x=new i.Cartesian3,P=new i.Cartesian3,N=new i.Cartesian3,L=new i.Cartesian3,I=new i.Cartesian3,z=new s.Matrix3,T=new s.Matrix3,U=new s.Matrix3,W=new s.Matrix3,B=new s.Matrix3,V=new s.Matrix3,Z=new s.Matrix3,k=new i.Cartesian3,A=new i.Cartesian3,j=new n.Cartographic;c.grazingAltitudeLocation=function(e,n){if(!r.defined(e))throw new t.DeveloperError("ray is required.");if(!r.defined(n))throw new t.DeveloperError("ellipsoid is required.");var o=e.origin,d=e.direction;if(!i.Cartesian3.equals(o,i.Cartesian3.ZERO)){var f=n.geodeticSurfaceNormal(o,x);if(i.Cartesian3.dot(d,f)>=0)return o}var l=r.defined(this.rayEllipsoid(e,n)),m=n.transformPositionToScaledSpace(d,x),p=i.Cartesian3.normalize(m,m),C=i.Cartesian3.mostOrthogonalAxis(m,L),c=i.Cartesian3.normalize(i.Cartesian3.cross(C,p,P),P),w=i.Cartesian3.normalize(i.Cartesian3.cross(p,c,N),N),v=z;v[0]=p.x,v[1]=p.y,v[2]=p.z,v[3]=c.x,v[4]=c.y,v[5]=c.z,v[6]=w.x,v[7]=w.y,v[8]=w.z;var M=s.Matrix3.transpose(v,T),b=s.Matrix3.fromScale(n.radii,U),g=s.Matrix3.fromScale(n.oneOverRadii,W),q=B;q[0]=0,q[1]=-d.z,q[2]=d.y,q[3]=d.z,q[4]=0,q[5]=-d.x,q[6]=-d.y,q[7]=d.x,q[8]=0;var E,y,D=s.Matrix3.multiply(s.Matrix3.multiply(M,g,V),q,V),R=s.Matrix3.multiply(s.Matrix3.multiply(D,b,Z),v,Z),S=s.Matrix3.multiplyByVector(D,o,I),F=function(e,r,t,n,o){var d,f=n*n,l=o*o,m=(e[s.Matrix3.COLUMN1ROW1]-e[s.Matrix3.COLUMN2ROW2])*l,p=o*(n*O(e[s.Matrix3.COLUMN1ROW0],e[s.Matrix3.COLUMN0ROW1],a.CesiumMath.EPSILON15)+r.y),C=e[s.Matrix3.COLUMN0ROW0]*f+e[s.Matrix3.COLUMN2ROW2]*l+n*r.x+t,c=l*O(e[s.Matrix3.COLUMN2ROW1],e[s.Matrix3.COLUMN1ROW2],a.CesiumMath.EPSILON15),w=o*(n*O(e[s.Matrix3.COLUMN2ROW0],e[s.Matrix3.COLUMN0ROW2])+r.z),v=[];if(0===w&&0===c){if(0===(d=u.computeRealRoots(m,p,C)).length)return v;var M=d[0],b=Math.sqrt(Math.max(1-M*M,0));if(v.push(new i.Cartesian3(n,o*M,o*-b)),v.push(new i.Cartesian3(n,o*M,o*b)),2===d.length){var g=d[1],q=Math.sqrt(Math.max(1-g*g,0));v.push(new i.Cartesian3(n,o*g,o*-q)),v.push(new i.Cartesian3(n,o*g,o*q))}return v}var E=w*w,y=c*c,D=w*c,R=m*m+y,S=2*(p*m+D),x=2*C*m+p*p-y+E,P=2*(C*p-D),N=C*C-E;if(0===R&&0===S&&0===x&&0===P)return v;var L=(d=h.computeRealRoots(R,S,x,P,N)).length;if(0===L)return v;for(var I=0;I<L;++I){var z=d[I],T=z*z,U=Math.max(1-T,0),W=Math.sqrt(U),B=(a.CesiumMath.sign(m)===a.CesiumMath.sign(C)?O(m*T+C,p*z,a.CesiumMath.EPSILON12):a.CesiumMath.sign(C)===a.CesiumMath.sign(p*z)?O(m*T,p*z+C,a.CesiumMath.EPSILON12):O(m*T+p*z,C,a.CesiumMath.EPSILON12))*O(c*z,w,a.CesiumMath.EPSILON15);B<0?v.push(new i.Cartesian3(n,o*z,o*W)):B>0?v.push(new i.Cartesian3(n,o*z,o*-W)):0!==W?(v.push(new i.Cartesian3(n,o*z,o*-W)),v.push(new i.Cartesian3(n,o*z,o*W)),++I):v.push(new i.Cartesian3(n,o*z,o*W))}return v}(R,i.Cartesian3.negate(S,x),0,0,1),G=F.length;if(G>0){for(var Y=i.Cartesian3.clone(i.Cartesian3.ZERO,A),_=Number.NEGATIVE_INFINITY,H=0;H<G;++H){E=s.Matrix3.multiplyByVector(b,s.Matrix3.multiplyByVector(v,F[H],k),k);var J=i.Cartesian3.normalize(i.Cartesian3.subtract(E,o,L),L),K=i.Cartesian3.dot(J,d);K>_&&(_=K,Y=i.Cartesian3.clone(E,Y))}var Q=n.cartesianToCartographic(Y,j);return _=a.CesiumMath.clamp(_,0,1),y=i.Cartesian3.magnitude(i.Cartesian3.subtract(Y,o,L))*Math.sqrt(1-_*_),y=l?-y:y,Q.height=y,n.cartographicToCartesian(Q,new i.Cartesian3)}};var F=new i.Cartesian3;c.lineSegmentPlane=function(e,n,o,s){if(!r.defined(e))throw new t.DeveloperError("endPoint0 is required.");if(!r.defined(n))throw new t.DeveloperError("endPoint1 is required.");if(!r.defined(o))throw new t.DeveloperError("plane is required.");r.defined(s)||(s=new i.Cartesian3);var u=i.Cartesian3.subtract(n,e,F),d=o.normal,f=i.Cartesian3.dot(d,u);if(!(Math.abs(f)<a.CesiumMath.EPSILON6)){var l=i.Cartesian3.dot(d,e),h=-(o.distance+l)/f;if(!(h<0||h>1))return i.Cartesian3.multiplyByScalar(u,h,s),i.Cartesian3.add(e,s,s),s}},c.trianglePlaneIntersection=function(e,a,n,o){if(!(r.defined(e)&&r.defined(a)&&r.defined(n)&&r.defined(o)))throw new t.DeveloperError("p0, p1, p2, and plane are required.");var s,u,d=o.normal,f=o.distance,l=i.Cartesian3.dot(d,e)+f<0,h=i.Cartesian3.dot(d,a)+f<0,m=i.Cartesian3.dot(d,n)+f<0,p=0;if(p+=l?1:0,p+=h?1:0,1!==(p+=m?1:0)&&2!==p||(s=new i.Cartesian3,u=new i.Cartesian3),1===p){if(l)return c.lineSegmentPlane(e,a,o,s),c.lineSegmentPlane(e,n,o,u),{positions:[e,a,n,s,u],indices:[0,3,4,1,2,4,1,4,3]};if(h)return c.lineSegmentPlane(a,n,o,s),c.lineSegmentPlane(a,e,o,u),{positions:[e,a,n,s,u],indices:[1,3,4,2,0,4,2,4,3]};if(m)return c.lineSegmentPlane(n,e,o,s),c.lineSegmentPlane(n,a,o,u),{positions:[e,a,n,s,u],indices:[2,3,4,0,1,4,0,4,3]}}else if(2===p){if(!l)return c.lineSegmentPlane(a,e,o,s),c.lineSegmentPlane(n,e,o,u),{positions:[e,a,n,s,u],indices:[1,2,4,1,4,3,0,3,4]};if(!h)return c.lineSegmentPlane(n,a,o,s),c.lineSegmentPlane(e,a,o,u),{positions:[e,a,n,s,u],indices:[2,0,4,2,4,3,1,3,4]};if(!m)return c.lineSegmentPlane(e,n,o,s),c.lineSegmentPlane(a,n,o,u),{positions:[e,a,n,s,u],indices:[0,1,4,0,4,3,2,3,4]}}},e.IntersectionTests=c,e.Ray=C}));
